<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://10kshuaizhang.github.io</id>
    <title>10K&apos;s</title>
    <updated>2023-06-19T06:53:56.745Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://10kshuaizhang.github.io"/>
    <link rel="self" href="https://10kshuaizhang.github.io/atom.xml"/>
    <subtitle>Shortcuts are the farthest path, so you must write and think honestly, which is the basic requirement for progress.</subtitle>
    <logo>https://10kshuaizhang.github.io/images/avatar.png</logo>
    <icon>https://10kshuaizhang.github.io/favicon.ico</icon>
    <rights>All rights reserved 2023, 10K&apos;s</rights>
    <entry>
        <title type="html"><![CDATA[79. Word Search]]></title>
        <id>https://10kshuaizhang.github.io/post/79-word-search/</id>
        <link href="https://10kshuaizhang.github.io/post/79-word-search/">
        </link>
        <updated>2023-06-19T06:53:31.000Z</updated>
        <content type="html"><![CDATA[<h2 id="question">Question</h2>
<p>Given an <code>m x n</code> grid of characters <code>board</code> and a string <code>word</code>, return <code>true</code> <em>if</em> <code>word</code> <em>exists in the grid</em>.</p>
<p>The word can be constructed from letters of sequentially adjacent cells, where adjacent cells are horizontally or vertically neighboring. The same letter cell may not be used more than once.</p>
<p><strong>Example 1:</strong></p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306191449923.jpg" alt="img" loading="lazy"></figure>
<pre><code>Input: board = [[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;E&quot;],[&quot;S&quot;,&quot;F&quot;,&quot;C&quot;,&quot;S&quot;],[&quot;A&quot;,&quot;D&quot;,&quot;E&quot;,&quot;E&quot;]], word = &quot;ABCCED&quot;
Output: true
</code></pre>
<p><strong>Constraints:</strong></p>
<ul>
<li><code>m == board.length</code></li>
<li><code>n = board[i].length</code></li>
<li><code>1 &lt;= m, n &lt;= 6</code></li>
<li><code>1 &lt;= word.length &lt;= 15</code></li>
<li><code>board</code> and <code>word</code> consists of only lowercase and uppercase English letters.</li>
</ul>
<h2 id="algorithm">Algorithm</h2>
<p>A typical backtracking problem, (or so called flood fill), we traverse all the elements in the board and start from each of those element to check if we can get a valid string.</p>
<p>The <code>helper(char[][] board, int i, int j, String word, int index)</code> helps us to do a DFS to check if starts from <code>board[i][j]</code>, can we find the the string <code>word.substring(i, word.length()-1)</code>.</p>
<h2 id="code">Code</h2>
<pre><code class="language-java">class Solution {
    boolean[][] visited;
    public boolean exist(char[][] board, String word) {
        int m = board.length;
        int n = board[0].length;
        visited = new boolean[m][n];
        for (int i = 0; i &lt; m; i++) {
            for (int j = 0; j &lt; n; j++) {
                if (helper(board, i, j, word, 0)) {
                    return true;
                }
            }
        }
        return false;
    }
    
    private boolean helper(char[][] board, int i, int j, String word, int index) {
        int m = board.length;
        int n = board[0].length;
        if (board[i][j] == word.charAt(index)) {
            if (index == word.length() - 1) {
                return true;
            } else {
                visited[i][j] = true;
                if (i-1 &gt;= 0 &amp;&amp; !visited[i-1][j]) {
                    if (helper(board, i-1, j, word, index+1)) {
                        return true;
                    }
                }
                if (i+1 &lt; m &amp;&amp; !visited[i+1][j]) {
                    if (helper(board, i+1, j, word, index+1)) {
                        return true;
                    }
                }
                if (j-1 &gt;= 0 &amp;&amp; !visited[i][j-1]) {
                   if (helper(board, i, j-1, word, index+1)) {
                       return true;
                   }
                }
                if (j+1 &lt; n &amp;&amp; !visited[i][j+1]) {
                    if (helper(board, i, j+1, word, index+1)) {
                        return true;
                    }
                }
                visited[i][j] = false;
            }
        }
        return false;
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°11-è®¾è®¡åŸåˆ™5-ä¾èµ–åè½¬]]></title>
        <id>https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-11-she-ji-yuan-ze-5-yi-lai-fan-zhuan/</id>
        <link href="https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-11-she-ji-yuan-ze-5-yi-lai-fan-zhuan/">
        </link>
        <updated>2023-06-19T05:57:23.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç†è®ºäº”æ§åˆ¶åè½¬-ä¾èµ–åè½¬-ä¾èµ–æ³¨å…¥è¿™ä¸‰è€…æœ‰ä½•åŒºåˆ«å’Œè”ç³»">ç†è®ºäº”ï¼šæ§åˆ¶åè½¬ã€ä¾èµ–åè½¬ã€ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸‰è€…æœ‰ä½•åŒºåˆ«å’Œè”ç³»ï¼Ÿ</h2>
<ul>
<li>ä¾èµ–åè½¬æŒ‡çš„æ˜¯<u>è°è·Ÿè°</u>çš„<u>ä»€ä¹ˆä¾èµ–</u>è¢«åè½¬äº†ï¼Ÿ<u>åè½¬</u>äºŒå­—åˆå¦‚ä½•ç†è§£ï¼Ÿ</li>
<li>æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥æ˜¯ä»€ä¹ˆï¼Ÿè¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ</li>
<li>Springä¸­çš„IoCè·Ÿè¿™äº›æ¦‚å¿µæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</li>
</ul>
<h3 id="æ§åˆ¶åè½¬ioc">æ§åˆ¶åè½¬ï¼ˆIOC)</h3>
<pre><code class="language-java">public class UserServiceTest {
  public static boolean doTest() {
    // ... 
  }
  
  public static void main(String[] args) {//è¿™éƒ¨åˆ†é€»è¾‘å¯ä»¥æ”¾åˆ°æ¡†æ¶ä¸­
    if (doTest()) {
      System.out.println(&quot;Test succeed.&quot;);
    } else {
      System.out.println(&quot;Test failed.&quot;);
    }
  }
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç æ‰€æœ‰çš„æµç¨‹éƒ½ç”±ç¨‹åºå‘˜æ¥æ§åˆ¶ï¼Œä¸‹é¢æˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªç®€å•çš„æ¡†æ¶ï¼š</p>
<pre><code class="language-java">public abstract class TestCase {
  public void run() {
    if (doTest()) {
      System.out.println(&quot;Test succeed.&quot;);
    } else {
      System.out.println(&quot;Test failed.&quot;);
    }
  }
  
  public abstract boolean doTest();
}

public class JunitApplication {
  private static final List&lt;TestCase&gt; testCases = new ArrayList&lt;&gt;();
  
  public static void register(TestCase testCase) {
    testCases.add(testCase);
  }
  
  public static final void main(String[] args) {
    for (TestCase case: testCases) {
      case.run();
    }
  }
</code></pre>
<p>æŠŠè¿™ä¸ªç®€åŒ–ç‰ˆçš„æµ‹è¯•æ¡†æ¶å¼•å…¥åˆ°å·¥ç¨‹åï¼Œåªéœ€åœ¨æ¡†æ¶é¢„ç•™çš„æ‰©å±•ç‚¹ï¼Œä¹Ÿå°±æ˜¯TestCaseç±»ä¸­çš„doTestæŠ½è±¡å‡½æ•°ä¸­ï¼Œå¡«å……å…·ä½“çš„æµ‹è¯•ä»£ç å°±å¯å®ç°ä¹‹å‰çš„åŠŸèƒ½äº†ï¼Œå®Œå…¨ä¸éœ€è¦å†™è´Ÿè´£æ‰§è¡Œæµç¨‹çš„mainå‡½æ•°äº†ï¼š</p>
<pre><code class="language-java">public class UserServiceTest extends TestCase {
  @Override
  public boolean doTest() {
    // ... 
  }
}

// æ³¨å†Œæ“ä½œè¿˜å¯ä»¥é€šè¿‡é…ç½®çš„æ–¹å¼æ¥å®ç°ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ˜¾ç¤ºè°ƒç”¨register()
JunitApplication.register(new UserServiceTest();
</code></pre>
<p>ä¸Šè¿°å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æ§åˆ¶åè½¬çš„ä¾‹å­ã€‚</p>
<ol>
<li>æ¡†æ¶æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„ä»£ç éª¨æ¶ï¼Œç”¨æ¥ç»„è£…å¯¹è±¡ã€ç®¡ç†æ•´ä¸ªæ‰§è¡Œæµç¨‹ã€‚ç¨‹åºå‘˜åˆ©ç”¨æ¡†æ¶è¿›è¡Œå¼€å‘çš„æ—¶å€™ï¼Œåªéœ€è¦å¾€é¢„ç•™çš„æ‰©å±•ç‚¹ä¸Šæ·»åŠ è·Ÿè‡ªå·±ä¸šåŠ¡ç›¸å…³çš„ä»£ç ï¼Œå°±å¯ä»¥åˆ©ç”¨æ¡†æ¶æ¥é©±åŠ¨æ•´ä¸ªæµç¨‹çš„æ‰§è¡Œã€‚</li>
<li>è¿™é‡Œçš„æ§åˆ¶ï¼ŒæŒ‡çš„æ˜¯å¯¹ç¨‹åºæ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œè€Œåè½¬ï¼ŒæŒ‡çš„æ˜¯åœ¨æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¹‹å‰ï¼Œç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ä½¿ç”¨æ¡†æ¶åï¼Œç¨‹åºçš„æ‰§è¡Œæµç¨‹å¯ä»¥é€šè¿‡æ¡†æ¶æ§åˆ¶ã€‚<u>æµç¨‹çš„æ§åˆ¶æƒä»ç¨‹åºå‘˜åè½¬åˆ°äº†æ¡†æ¶ã€‚</u></li>
<li>æ§åˆ¶åè½¬æ˜¯ä¸€ä¸ªæŒ‡å¯¼æ€æƒ³ï¼Œä¸æ˜¯ä¸€ç§å…·ä½“çš„å®ç°æŠ€å·§ã€‚</li>
</ol>
<h3 id="ä¾èµ–æ³¨å…¥di">ä¾èµ–æ³¨å…¥(DI)</h3>
<ol>
<li>
<p>Dependency injectionï¼Œæ˜¯ä¸€ç§å…·ä½“çš„ç¼–ç æŠ€å·§ã€‚</p>
</li>
<li>
<p><strong><u>ä¸é€šè¿‡new()çš„æ–¹å¼åœ¨ç±»å†…éƒ¨ä¾èµ–ç±»å¯¹è±¡ï¼Œè€Œæ˜¯å°†ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’ï¼ˆæ³¨å…¥ï¼‰ç»™ç±»ä½¿ç”¨ã€‚</u></strong></p>
</li>
<li>
<p>çœ‹ä¸€ä¸ªä¾‹å­å§ï¼šNotification ç±»è´Ÿè´£æ¶ˆæ¯æ¨é€ï¼Œä¾èµ– MessageSender ç±»å®ç°æ¨é€å•†å“ä¿ƒé”€ã€éªŒè¯ç ç­‰æ¶ˆæ¯ç»™ç”¨æˆ·ã€‚æˆ‘ä»¬åˆ†åˆ«ç”¨ä¾èµ–æ³¨å…¥å’Œéä¾èµ–æ³¨å…¥ä¸¤ç§æ–¹å¼æ¥å®ç°ä¸€ä¸‹ã€‚</p>
<pre><code class="language-java">// éä¾èµ–æ³¨å…¥å®ç°æ–¹å¼
public class Notification {
  private MessageSender messageSender;
  
  public Notification() {
    this.messageSender = new MessageSender(); //æ­¤å¤„æœ‰ç‚¹åƒhardcode
  }
  
  public void sendMessage(String cellphone, String message) {
    //...çœç•¥æ ¡éªŒé€»è¾‘ç­‰...
    this.messageSender.send(cellphone, message);
  }
}

public class MessageSender {
  public void send(String cellphone, String message) {
    //....
  }
}
// ä½¿ç”¨Notification
Notification notification = new Notification();
</code></pre>
<pre><code class="language-java">// ä¾èµ–æ³¨å…¥çš„å®ç°æ–¹å¼
public class Notification {
  private MessageSender messageSender;
  
  // é€šè¿‡æ„é€ å‡½æ•°å°†messageSenderä¼ é€’è¿›æ¥
  public Notification(MessageSender messageSender) {
    this.messageSender = messageSender;
  }
  
  public void sendMessage(String cellphone, String message) {
    //...çœç•¥æ ¡éªŒé€»è¾‘ç­‰...
    this.messageSender.send(cellphone, message);
  }
}

public class MessageSender {
  public void send(String cellphone, String message) {
    //....
  }
}

//ä½¿ç”¨Notification
MessageSender messageSender = new MessageSender();
Notification notification = new Notification(messageSender);
</code></pre>
<p>é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼å°†ä¾èµ–çš„ç±»ä¼ é€’è¿›æ¥ï¼Œæé«˜äº†ä»£ç çš„æ‰©å±•æ€§ã€‚</p>
</li>
<li>
<p>ä¸Šè¿°ä»£ç è¿˜å¯ä»¥ä¼˜åŒ–ï¼ŒmessageSenderå¯ä»¥è¢«å®šä¹‰æˆæ¥å£ï¼š</p>
<pre><code class="language-java">public class Notification {
  private MessageSender messageSender;
  
  public Notification(MessageSender messageSender) {
    this.messageSender = messageSender;
  }
  
  public void sendMessage(String cellphone, String message) {
    this.messageSender.send(cellphone, message);
  }
}

public interface MessageSender {
  void send(String cellphone, String message);
}

// çŸ­ä¿¡å‘é€ç±»
public class SmsSender implements MessageSender {
  @Override
  public void send(String cellphone, String message) {
    //....
  }
}

// ç«™å†…ä¿¡å‘é€ç±»
public class InboxSender implements MessageSender {
  @Override
  public void send(String cellphone, String message) {
    //....
  }
}

//ä½¿ç”¨Notification
MessageSender messageSender = new SmsSender();
Notification notification = new Notification(messageSender);
</code></pre>
</li>
</ol>
<h3 id="ä¾èµ–æ³¨å…¥æ¡†æ¶di-framework">ä¾èµ–æ³¨å…¥æ¡†æ¶(DI Framework)</h3>
<ol>
<li>
<p>åœ¨ä¹‹å‰çš„ä¾èµ–æ³¨å…¥å®ç°çš„MessageSenderå’ŒNotificationçš„ä¾‹å­ä¸­ï¼Œè™½ç„¶ä¸éœ€è¦åœ¨Notificationä¸­hard code MessageSenderï¼Œä½†æ˜¯ç¨‹åºå‘˜è¿˜æ˜¯è¦åœ¨æ›´ä¸Šå±‚å»åˆå§‹åŒ–å’Œè£…é…è¿™ä¸ªMessageSenderå¯¹è±¡ï¼š</p>
<pre><code class="language-java">public class Demo {
  public static final void main(String args[]) {
    MessageSender sender = new SmsSender(); //åˆ›å»ºå¯¹è±¡
    Notification notification = new Notification(sender);//ä¾èµ–æ³¨å…¥
    notification.sendMessage(&quot;13918942177&quot;, &quot;çŸ­ä¿¡éªŒè¯ç ï¼š2346&quot;);
  }
}
</code></pre>
</li>
<li>
<p>éšç€ä»£ç é‡å˜å¤§ï¼Œå¯¹è±¡ä¼šå˜å¾—å¾ˆå¤šï¼Œæ¡†æ¶å¯ä»¥å¸®æˆ‘ä»¬åšè¿™ä¸ªåˆå§‹åŒ–å’Œæ³¨å…¥çš„äº‹æƒ…ã€‚æˆ‘ä»¬åªéœ€é…ç½®ä¸€ä¸‹éœ€è¦åˆ›å»ºçš„ç±»å¯¹è±¡ï¼Œä»¥åŠç±»ä¹‹é—´çš„å…³ç³»ã€‚</p>
</li>
</ol>
<h3 id="ä¾èµ–åè½¬åŸåˆ™dip">ä¾èµ–åè½¬åŸåˆ™ï¼ˆDIP)</h3>
<ol>
<li>Dependency Inversion Principleï¼ŒDIPï¼šHigh-level modules shouldn't depend on low-level modules. Both modules should depend on abstractions. In addition, abstractions shouldn't depend on details. Details depend on abstractions.</li>
<li>é«˜å±‚æ¨¡å—ä¸è¦ä¾èµ–ä½å±‚æ¨¡å—ï¼Œé«˜å±‚æ¨¡å—å’Œä½å±‚æ¨¡å—åº”è¯¥é€šè¿‡æŠ½è±¡äº’ç›¸ä¾èµ–ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒæŠ½è±¡ä¸éœ€è¦ä¾èµ–å…·ä½“å®ç°ç»†èŠ‚ï¼Œå…·ä½“å®ç°ç»†èŠ‚ä¾èµ–æŠ½è±¡ã€‚</li>
<li>é«˜å±‚æ¨¡å—å’Œä½å±‚æ¨¡å—ï¼šå°±æ˜¯è°ƒç”¨é“¾ä¸Šè°ƒç”¨è€…æ˜¯é«˜å±‚ï¼Œè¢«è°ƒç”¨è€…å±äºä½å±‚ã€‚å¹³æ—¶é«˜å±‚ä¾èµ–ä½å±‚æ˜¯æ²¡é—®é¢˜çš„ï¼Œè¿™ä¸ªDIPè¿˜æ˜¯æŒ‡å¯¼æ¡†æ¶è®¾è®¡çš„ã€‚</li>
<li>ä¸¾ä¸ªTomcaè¿™ä¸ªServletå®¹å™¨çš„ä¾‹å­ï¼šTomcatæ˜¯è¿è¡ŒJava Webçš„åº”ç”¨ç¨‹åºçš„å®¹å™¨ï¼Œæˆ‘ä»¬ä¾¿æ´—çš„Webåº”ç”¨ç¨‹åºåªéœ€è¦éƒ¨ç½²åœ¨Tomcatå®¹å™¨ä¸‹ï¼Œä¾¿å¯ä»¥è¢«Tomcatå®¹å™¨è°ƒç”¨æ‰§è¡Œã€‚<u>æŒ‰ç…§ä¹‹å‰çš„åˆ’åˆ†åŸåˆ™ï¼ŒTomcat å°±æ˜¯é«˜å±‚æ¨¡å—ï¼Œæˆ‘ä»¬ç¼–å†™çš„ Web åº”ç”¨ç¨‹åºä»£ç å°±æ˜¯ä½å±‚æ¨¡å—ã€‚Tomcat å’Œåº”ç”¨ç¨‹åºä»£ç ä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œä¸¤è€…éƒ½ä¾èµ–åŒä¸€ä¸ªâ€œæŠ½è±¡â€ï¼Œä¹Ÿå°±æ˜¯ Servlet è§„èŒƒã€‚Servlet è§„èŒƒä¸ä¾èµ–å…·ä½“çš„ Tomcat å®¹å™¨å’Œåº”ç”¨ç¨‹åºçš„å®ç°ç»†èŠ‚ï¼Œè€Œ Tomcat å®¹å™¨å’Œåº”ç”¨ç¨‹åºä¾èµ– Servlet è§„èŒƒã€‚</u></li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°10-è®¾è®¡åŸåˆ™4-æ¥å£éš”ç¦»]]></title>
        <id>https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-10-she-ji-yuan-ze-4-jie-kou-ge-chi/</id>
        <link href="https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-10-she-ji-yuan-ze-4-jie-kou-ge-chi/">
        </link>
        <updated>2023-06-19T03:04:03.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç†è®ºå››æ¥å£éš”ç¦»åŸåˆ™æœ‰å“ªä¸‰ç§åº”ç”¨åŸåˆ™ä¸­çš„æ¥å£è¯¥å¦‚ä½•ç†è§£">ç†è®ºå››ï¼šæ¥å£éš”ç¦»åŸåˆ™æœ‰å“ªä¸‰ç§åº”ç”¨ï¼ŸåŸåˆ™ä¸­çš„â€œæ¥å£â€è¯¥å¦‚ä½•ç†è§£ï¼Ÿ</h2>
<h3 id="å¦‚ä½•ç†è§£æ¥å£éš”ç¦»åŸåˆ™">å¦‚ä½•ç†è§£â€æ¥å£éš”ç¦»åŸåˆ™â€œ</h3>
<ol>
<li>Interface Segregation Principle: ISP. Clients should not be force to depend upon interfaces that they not use. å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨è€…ã€ä½¿ç”¨è€…ï¼‰åº”è¯¥è¢«å¼ºè¿«ä¾èµ–ä»–ä¸éœ€è¦çš„æ¥å£ã€‚</li>
<li>å…³é”®åœ¨äºå¦‚ä½•ç†è§£æ¥å£
<ul>
<li>ä¸€ç»„APIæ¥å£é›†åˆ</li>
<li>å•ä¸ªAPIæ¥å£æˆ–å‡½æ•°</li>
<li>OOPä¸­çš„æ¥å£æ¦‚å¿µ</li>
</ul>
</li>
</ol>
<h3 id="æŠŠæ¥å£ç†è§£ä¸ºä¸€ç»„apiæ¥å£é›†åˆ">æŠŠæ¥å£ç†è§£ä¸ºä¸€ç»„APIæ¥å£é›†åˆ</h3>
<ol>
<li>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¾®æœåŠ¡ç”¨æˆ·ç³»ç»Ÿæä¾›äº†ä¸€ç»„è·Ÿç”¨æˆ·ç›¸å…³çš„ API ç»™å…¶ä»–ç³»ç»Ÿä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šæ³¨å†Œã€ç™»å½•ã€è·å–ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚</p>
<pre><code class="language-java">public interface UserService {
  boolean register(String cellphone, String password);
  boolean login(String cellphone, String password);
  UserInfo getUserInfoById(long id);
  UserInfo getUserInfoByCellphone(String cellphone);
}

public class UserServiceImpl implements UserService {
  //...
}
</code></pre>
</li>
<li>
<p>å¦‚æœç°åœ¨è¦å®ç°åˆ é™¤ç”¨æˆ·çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°çš„æ˜¯åœ¨æ¥å£ä¸­å¢åŠ ä¸€ä¸ªæ–¹æ³•<code>deleteUserById</code>.</p>
<ol>
<li>
<p>é—®é¢˜åœ¨äºï¼Œåˆ é™¤ç”¨æˆ·çš„æƒé™æœ€å¥½æ˜¯åå°ç®¡ç†ç³»ç»Ÿæ‰§è¡Œã€‚å¦‚æœæ”¾è¿›å»UserServiceï¼Œé‚£æ‰€æœ‰å®ç°è¿™ä¸ªæ¥å£çš„ç±»éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£ã€‚<u>ä¸åŠ é™åˆ¶çš„è¢«å…¶ä»–ä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨ï¼Œæœ‰å¯èƒ½å¯¼è‡´è¯¯åˆ ç”¨æˆ·ã€‚</u></p>
</li>
<li>
<p>æœ€å¥½çš„è®¾è®¡æ˜¯ä»æ¶æ„å±‚é¢ï¼Œå¢åŠ é‰´æƒç³»ç»Ÿæ¥é™åˆ¶æ¥å£çš„è°ƒç”¨ã€‚ä½†æ˜¯ç›®å‰æ²¡æœ‰æ”¯æŒçš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»ä»£ç å±‚é¢å»åšã€‚</p>
</li>
<li>
<p>å‚ç…§æ¥å£éš”ç¦»åŸåˆ™ï¼Œè°ƒç”¨è€…ä¸åº”è¯¥å¼ºè¿«ä¾èµ–ä»–ä¸éœ€è¦çš„æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥å°†åˆ é™¤æ¥å£å•ç‹¬æ”¾åˆ°å¦ä¸€ä¸ªæ¥å£<code>RestrictedUserService</code>ä¸­ï¼Œç„¶åå°†è¿™ä¸ªServiceåªæ‰“åŒ…ç»™åå°ç®¡ç†ç³»ç»Ÿä½¿ç”¨ï¼š</p>
<pre><code class="language-java">public interface UserService {
  boolean register(String cellphone, String password);
  boolean login(String cellphone, String password);
  UserInfo getUserInfoById(long id);
  UserInfo getUserInfoByCellphone(String cellphone);
}

public interface RestrictedUserService {
  boolean deleteUserByCellphone(String cellphone);
  boolean deleteUserById(long id);
}

public class UserServiceImpl implements UserService, RestrictedUserService {
  // ...çœç•¥å®ç°ä»£ç ...
}
</code></pre>
</li>
</ol>
</li>
<li>
<p>æ¥å£åœ¨è¿™é‡Œè¢«ç†è§£ä¸ºä¸€ç»„æ¥å£é›†åˆã€‚åœ¨è®¾è®¡å¾®æœåŠ¡æˆ–è€…ç±»åº“æ¥å£çš„æ—¶å€™ï¼Œå¦‚æœéƒ¨åˆ†æ¥å£åªè¢«éƒ¨åˆ†è°ƒç”¨è€…ä½¿ç”¨ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å°†è¿™éƒ¨åˆ†æ¥å£éš”ç¦»å‡ºæ¥ï¼Œå•ç‹¬ç»™å¯¹åº”çš„è°ƒç”¨è€…ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å¼ºè¿«å…¶ä»–è°ƒç”¨è€…ä¹Ÿä¾èµ–è¿™éƒ¨åˆ†ä¸ä¼šè¢«ç”¨åˆ°çš„æ¥å£ã€‚</p>
</li>
</ol>
<h3 id="æŠŠæ¥å£ç†è§£ä¸ºå•ä¸ªapiæ¥å£æˆ–å‡½æ•°">æŠŠæ¥å£ç†è§£ä¸ºå•ä¸ªAPIæ¥å£æˆ–å‡½æ•°</h3>
<ol>
<li>
<p>å¦‚æœå°†æ¥å£ç†è§£ä¸ºä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…å‡½æ•°ã€‚é‚£æˆ‘ä»¬è¿™ä¸ªåŸåˆ™çš„ç†è§£å°±æ˜¯ï¼š å‡½æ•°çš„è®¾è®¡è¦åŠŸèƒ½å•ä¸€ï¼Œä¸è¦è®²å¤šä¸ªä¸åŒçš„åŠŸèƒ½é€»è¾‘åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®ç°ã€‚</p>
</li>
<li>
<p>çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-java">public class Statistics {
  private Long max;
  private Long min;
  private Long average;
  private Long sum;
  private Long percentile99;
  private Long percentile999;
  //...çœç•¥constructor/getter/setterç­‰æ–¹æ³•...
}

public Statistics count(Collection&lt;Long&gt; dataSet) {
  Statistics statistics = new Statistics();
  //...çœç•¥è®¡ç®—é€»è¾‘...
  return statistics;
}
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œcountåšçš„äº‹æƒ…ä¸ä»…æ˜¯countï¼Œè¿˜ç®—äº†min maxç­‰ï¼Œå¯ä»¥æ‹†æˆæ›´ç»†çš„ç²’åº¦ã€‚</p>
<pre><code class="language-java">public Long max(Collection&lt;Long&gt; dataSet) { //... }
public Long min(Collection&lt;Long&gt; dataSet) { //... } 
public Long average(Colletion&lt;Long&gt; dataSet) { //... }
// ...çœç•¥å…¶ä»–ç»Ÿè®¡å‡½æ•°...
</code></pre>
</li>
<li>
<p>æ˜¯å¦åŠŸèƒ½å•ä¸€ï¼Œè¿˜æ˜¯è¦å‚ç…§ä¸šåŠ¡åœºæ™¯ã€‚</p>
<p>å¦‚æœåœ¨é¡¹ç›®ä¸­ï¼Œå¯¹æ¯ä¸ªç»Ÿè®¡éœ€æ±‚ï¼ŒStatistics å®šä¹‰çš„é‚£å‡ ä¸ªç»Ÿè®¡ä¿¡æ¯éƒ½æœ‰æ¶‰åŠï¼Œé‚£ count() å‡½æ•°çš„è®¾è®¡å°±æ˜¯åˆç†çš„ã€‚ç›¸åï¼Œå¦‚æœæ¯ä¸ªç»Ÿè®¡éœ€æ±‚åªæ¶‰åŠ Statistics ç½—åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ä¸­ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚ï¼Œæœ‰çš„åªéœ€è¦ç”¨åˆ° maxã€minã€average è¿™ä¸‰ç±»ç»Ÿè®¡ä¿¡æ¯ï¼Œæœ‰çš„åªéœ€è¦ç”¨åˆ° averageã€sumã€‚è€Œ count() å‡½æ•°æ¯æ¬¡éƒ½ä¼šæŠŠæ‰€æœ‰çš„ç»Ÿè®¡ä¿¡æ¯è®¡ç®—ä¸€éï¼Œå°±ä¼šåšå¾ˆå¤šæ— ç”¨åŠŸï¼ŒåŠ¿å¿…å½±å“ä»£ç çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ç»Ÿè®¡çš„æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹ï¼Œcount() å‡½æ•°çš„è®¾è®¡å°±æœ‰ç‚¹ä¸åˆç†äº†ï¼Œæˆ‘ä»¬åº”è¯¥æŒ‰ç…§ç¬¬äºŒç§è®¾è®¡æ€è·¯ï¼Œå°†å…¶æ‹†åˆ†æˆç²’åº¦æ›´ç»†çš„å¤šä¸ªç»Ÿè®¡å‡½æ•°ã€‚</p>
</li>
<li>
<p>ISPå’ŒSRPæœ‰ç‚¹åŒºåˆ«çš„ï¼š SPRé’ˆå¯¹çš„æ˜¯ç±»å’Œæ¨¡å—çš„è®¾è®¡ï¼Œè€ŒISPæ›´ä¾§é‡äºæ¥å£çš„è®¾è®¡ã€‚å®ƒæä¾›äº†ä¸€ç§åˆ¤æ–­æ¥å£æ˜¯å¦èŒè´£å•ä¸€çš„æ ‡å‡†ï¼šé€šè¿‡è°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨æ¥å£æ¥é—´æ¥çš„åˆ¤å®šã€‚ï¼ˆæ˜¯å¦æ˜¯éƒ¨åˆ†ä½¿ç”¨ï¼‰ã€‚</p>
</li>
</ol>
<h3 id="æŠŠæ¥å£ç†è§£ä¸ºoopä¸­çš„æ¥å£">æŠŠæ¥å£ç†è§£ä¸ºOOPä¸­çš„æ¥å£</h3>
<ol>
<li>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬çš„é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸‰ä¸ªå¤–éƒ¨ç³»ç»Ÿï¼šRedisã€MySQLã€Kafkaã€‚æ¯ä¸ªç³»ç»Ÿéƒ½å¯¹åº”ä¸€ç³»åˆ—é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚åœ°å€ã€ç«¯å£ã€è®¿é—®è¶…æ—¶æ—¶é—´ç­‰ã€‚ä¸ºäº†åœ¨å†…å­˜ä¸­å­˜å‚¨è¿™äº›é…ç½®ä¿¡æ¯ï¼Œä¾›é¡¹ç›®ä¸­çš„å…¶ä»–æ¨¡å—æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬åˆ†åˆ«è®¾è®¡å®ç°äº†ä¸‰ä¸ª Configuration ç±»ï¼šRedisConfigã€MysqlConfigã€KafkaConfigã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚è¿™é‡Œåªç»™å‡ºäº† RedisConfig çš„ä»£ç å®ç°ï¼š</p>
<pre><code class="language-java">public class RedisConfig {
    private ConfigSource configSource; //é…ç½®ä¸­å¿ƒï¼ˆæ¯”å¦‚zookeeperï¼‰
    private String address;
    private int timeout;
    private int maxTotal;
    //çœç•¥å…¶ä»–é…ç½®: maxWaitMillis,maxIdle,minIdle...

    public RedisConfig(ConfigSource configSource) {
        this.configSource = configSource;
    }

    public String getAddress() {
        return this.address;
    }
    //...çœç•¥å…¶ä»–get()ã€init()æ–¹æ³•...

    public void update() {
      //ä»configSourceåŠ è½½é…ç½®åˆ°address/timeout/maxTotal...
    }
}

public class KafkaConfig { //...çœç•¥... }
public class MysqlConfig { //...çœç•¥... }
</code></pre>
</li>
<li>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„åŠŸèƒ½éœ€æ±‚ï¼Œå¸Œæœ›æ”¯æŒ Redis å’Œ Kafka é…ç½®ä¿¡æ¯çš„çƒ­æ›´æ–°ã€‚æ‰€è°“â€œçƒ­æ›´æ–°ï¼ˆhot updateï¼‰â€å°±æ˜¯ï¼Œå¦‚æœåœ¨é…ç½®ä¸­å¿ƒä¸­æ›´æ”¹äº†é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ä¸ç”¨é‡å¯ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œèƒ½å°†æœ€æ–°çš„é…ç½®ä¿¡æ¯åŠ è½½åˆ°å†…å­˜ä¸­ï¼ˆä¹Ÿå°±æ˜¯ RedisConfigã€KafkaConfig ç±»ä¸­ï¼‰ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›å¯¹ MySQL çš„é…ç½®ä¿¡æ¯è¿›è¡Œçƒ­æ›´æ–°ã€‚</p>
</li>
<li>
<p>ä¸ºäº†å®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½éœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡å®ç°äº†ä¸€ä¸ª ScheduledUpdater ç±»ï¼Œä»¥å›ºå®šæ—¶é—´é¢‘ç‡ï¼ˆperiodInSecondsï¼‰æ¥è°ƒç”¨ RedisConfigã€KafkaConfig çš„ update() æ–¹æ³•æ›´æ–°é…ç½®ä¿¡æ¯ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-java">public interface Updater {
  void update();
}

public class RedisConfig implements Updater {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
}

public class KafkaConfig implements Updater {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
}

public class MysqlConfig { //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•... }

public class ScheduledUpdater {
    private final ScheduledExecutorService executor = Executors.newSingleThreadScheduledExecutor();;
    private long initialDelayInSeconds;
    private long periodInSeconds;
    private Updater updater;

    public ScheduleUpdater(Updater updater, long initialDelayInSeconds, long periodInSeconds) {
        this.updater = updater;
        this.initialDelayInSeconds = initialDelayInSeconds;
        this.periodInSeconds = periodInSeconds;
    }

    public void run() {
        executor.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                updater.update();
            }
        }, this.initialDelayInSeconds, this.periodInSeconds, TimeUnit.SECONDS);
    }
}

public class Application {
  ConfigSource configSource = new ZookeeperConfigSource(/*çœç•¥å‚æ•°*/);
  public static final RedisConfig redisConfig = new RedisConfig(configSource);
  public static final KafkaConfig kafkaConfig = new KakfaConfig(configSource);
  public static final MySqlConfig mysqlConfig = new MysqlConfig(configSource);

  public static void main(String[] args) {
    ScheduledUpdater redisConfigUpdater = new ScheduledUpdater(redisConfig, 300, 300);
    redisConfigUpdater.run();
    
    ScheduledUpdater kafkaConfigUpdater = new ScheduledUpdater(kafkaConfig, 60, 60);
    kafkaConfigUpdater.run();
  }
}
</code></pre>
</li>
<li>
<p>åˆšåˆšçš„çƒ­æ›´æ–°çš„éœ€æ±‚æˆ‘ä»¬å·²ç»æå®šäº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åˆæœ‰äº†ä¸€ä¸ªæ–°çš„ç›‘æ§åŠŸèƒ½éœ€æ±‚ã€‚é€šè¿‡å‘½ä»¤è¡Œæ¥æŸ¥çœ‹ Zookeeper ä¸­çš„é…ç½®ä¿¡æ¯æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½æœ‰ä¸€ç§æ›´åŠ æ–¹ä¾¿çš„é…ç½®ä¿¡æ¯æŸ¥çœ‹æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­å¼€å‘ä¸€ä¸ªå†…åµŒçš„ SimpleHttpServerï¼Œè¾“å‡ºé¡¹ç›®çš„é…ç½®ä¿¡æ¯åˆ°ä¸€ä¸ªå›ºå®šçš„ HTTP åœ°å€ï¼Œæ¯”å¦‚ï¼šhttp://127.0.0.1:2389/config ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨æµè§ˆå™¨ä¸­è¾“å…¥è¿™ä¸ªåœ°å€ï¼Œå°±å¯ä»¥æ˜¾ç¤ºå‡ºç³»ç»Ÿçš„é…ç½®ä¿¡æ¯ã€‚ä¸è¿‡ï¼Œå‡ºäºæŸäº›åŸå› ï¼Œæˆ‘ä»¬åªæƒ³æš´éœ² MySQL å’Œ Redis çš„é…ç½®ä¿¡æ¯ï¼Œä¸æƒ³æš´éœ² Kafka çš„é…ç½®ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬è¿˜éœ€è¦å¯¹ä¸Šé¢çš„ä»£ç åšè¿›ä¸€æ­¥æ”¹é€ :</p>
<pre><code class="language-java">public interface Updater {
  void update();
}

public interface Viewer {
  String outputInPlainText();
  Map&lt;String, String&gt; output();
}

public class RedisConfig implemets Updater, Viewer {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
  @Override
  public String outputInPlainText() { //... }
  @Override
  public Map&lt;String, String&gt; output() { //...}
}

public class KafkaConfig implements Updater {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public void update() { //... }
}

public class MysqlConfig implements Viewer {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
  @Override
  public String outputInPlainText() { //... }
  @Override
  public Map&lt;String, String&gt; output() { //...}
}

public class SimpleHttpServer {
  private String host;
  private int port;
  private Map&lt;String, List&lt;Viewer&gt;&gt; viewers = new HashMap&lt;&gt;();
  
  public SimpleHttpServer(String host, int port) {//...}
  
  public void addViewers(String urlDirectory, Viewer viewer) {
    if (!viewers.containsKey(urlDirectory)) {
      viewers.put(urlDirectory, new ArrayList&lt;Viewer&gt;());
    }
    this.viewers.get(urlDirectory).add(viewer);
  }
  
  public void run() { //... }
}

public class Application {
    ConfigSource configSource = new ZookeeperConfigSource();
    public static final RedisConfig redisConfig = new RedisConfig(configSource);
    public static final KafkaConfig kafkaConfig = new KakfaConfig(configSource);
    public static final MySqlConfig mysqlConfig = new MySqlConfig(configSource);
    
    public static void main(String[] args) {
        ScheduledUpdater redisConfigUpdater =
            new ScheduledUpdater(redisConfig, 300, 300);
        redisConfigUpdater.run();
        
        ScheduledUpdater kafkaConfigUpdater =
            new ScheduledUpdater(kafkaConfig, 60, 60);
        redisConfigUpdater.run();
        
        SimpleHttpServer simpleHttpServer = new SimpleHttpServer(â€œ127.0.0.1â€, 2389);
        simpleHttpServer.addViewer(&quot;/config&quot;, redisConfig);
        simpleHttpServer.addViewer(&quot;/config&quot;, mysqlConfig);
        simpleHttpServer.run();
    }
}
</code></pre>
</li>
<li>
<p>åœ¨viewerå’Œupdaterè¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼ŒScheduledUpdateråªä¾èµ–Updaterï¼Œä¸éœ€è¦è¢«å¼ºè¿«å»ä¾èµ–viewerã€‚æ»¡è¶³æ¥å£éš”ç¦»åŸåˆ™ã€‚</p>
</li>
<li>
<p>å¦‚æœä¸éµå¾ªISPï¼Œè®¾è®¡å‡ºæ¥çš„ä»£ç å¯èƒ½æ˜¯ï¼šä¸€ä¸ªå¤§çš„configæ¥å£åŒ…å«æ‰€æœ‰æ–¹æ³•ï¼Œæ‰€æœ‰å®ç°ä»–çš„ç±»éƒ½å¿…é¡»å®ç°æ‰€æœ‰æ–¹æ³•ï¼š</p>
<pre><code class="language-java">public interface Config {
  void update();
  String outputInPlainText();
  Map&lt;String, String&gt; output();
}

public class RedisConfig implements Config {
  //...éœ€è¦å®ç°Configçš„ä¸‰ä¸ªæ¥å£update/outputIn.../output
}

public class KafkaConfig implements Config {
  //...éœ€è¦å®ç°Configçš„ä¸‰ä¸ªæ¥å£update/outputIn.../output
}

public class MysqlConfig implements Config {
  //...éœ€è¦å®ç°Configçš„ä¸‰ä¸ªæ¥å£update/outputIn.../output
}

public class ScheduledUpdater {
  //...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•..
  private Config config;

  public ScheduleUpdater(Config config, long initialDelayInSeconds, long periodInSeconds) {
      this.config = config;
      //...
  }
  //...
}

public class SimpleHttpServer {
  private String host;
  private int port;
  private Map&lt;String, List&lt;Config&gt;&gt; viewers = new HashMap&lt;&gt;();
 
  public SimpleHttpServer(String host, int port) {//...}
  
  public void addViewer(String urlDirectory, Config config) {
    if (!viewers.containsKey(urlDirectory)) {
      viewers.put(urlDirectory, new ArrayList&lt;Config&gt;());
    }
    viewers.get(urlDirectory).add(config);
  }
  
  public void run() { //... }
}
</code></pre>
</li>
<li>
<p>ä¹Ÿèƒ½å®ç°ï¼Œä½†æ˜¯å¯¹æ¯”ä¹‹å‰çš„è®¾è®¡ï¼Œæ˜æ˜¾éµå¾ªäº†ISPçš„ä»£ç **<u>æ‰©å±•æ€§æ›´å¥½ï¼Œæ›´çµæ´»ã€‚</u>**å› ä¸ºUpdaterå’ŒViewerèŒè´£æ›´å•ä¸€ï¼Œå•ä¸€æ„å‘³ç€é€šç”¨ã€å¤ç”¨æ€§å¥½ã€‚æ¯”å¦‚æˆ‘ä»¬åˆä¸Šäº†ä¸€ä¸ªMetricsæ€§èƒ½ç»Ÿè®¡æ¨¡å—ï¼Œå¹¶å¸Œæœ›Metricsä¹Ÿé€šè¿‡SimpleHttpServeræ˜¾ç¤ºï¼Œæ­¤æ—¶ä»–å°±å¯ä»¥ä½¿ç”¨Vieweræ¥å£:</p>
<pre><code class="language-java">public class ApiMetrics implements Viewer {//...}
public class DbMetrics implements Viewer {//...}

public class Application {
    ConfigSource configSource = new ZookeeperConfigSource();
    public static final RedisConfig redisConfig = new RedisConfig(configSource);
    public static final KafkaConfig kafkaConfig = new KakfaConfig(configSource);
    public static final MySqlConfig mySqlConfig = new MySqlConfig(configSource);
    public static final ApiMetrics apiMetrics = new ApiMetrics();
    public static final DbMetrics dbMetrics = new DbMetrics();
    
    public static void main(String[] args) {
        SimpleHttpServer simpleHttpServer = new SimpleHttpServer(â€œ127.0.0.1â€, 2389);
        simpleHttpServer.addViewer(&quot;/config&quot;, redisConfig);
        simpleHttpServer.addViewer(&quot;/config&quot;, mySqlConfig);
        simpleHttpServer.addViewer(&quot;/metrics&quot;, apiMetrics);
        simpleHttpServer.addViewer(&quot;/metrics&quot;, dbMetrics);
        simpleHttpServer.run();
    }
}
</code></pre>
</li>
<li>
<p>ç¬¬äºŒç§è®¾è®¡ä¹Ÿæœ‰ä¸€äº›æ— ç”¨åŠŸï¼Œæ­£å¦‚æˆ‘å‰é¢è¯´çš„ï¼Œ å¿…é¡»è¦å®ç°æ‰€æœ‰æ–¹æ³•ï¼ˆå°½ç®¡ä»–ä¸éœ€è¦ç”¨ï¼‰ã€‚</p>
</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°7-è®¾è®¡åŸåˆ™3-é‡Œæ°æ›¿æ¢ï¼ˆLSP)]]></title>
        <id>https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-7-she-ji-yuan-ze-3-li-shi-ti-huan-lsp/</id>
        <link href="https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-7-she-ji-yuan-ze-3-li-shi-ti-huan-lsp/">
        </link>
        <updated>2023-06-18T05:21:16.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç†è®ºä¸‰é‡Œå¼æ›¿æ¢lspè·Ÿå¤šæ€æœ‰ä½•åŒºåˆ«å“ªäº›ä»£ç è¿èƒŒäº†lsp">ç†è®ºä¸‰ï¼šé‡Œå¼æ›¿æ¢ï¼ˆLSPï¼‰è·Ÿå¤šæ€æœ‰ä½•åŒºåˆ«ï¼Ÿå“ªäº›ä»£ç è¿èƒŒäº†LSPï¼Ÿ</h2>
<h3 id="å¦‚ä½•ç†è§£é‡Œæ°æ›¿æ¢åŸåˆ™">å¦‚ä½•ç†è§£é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Ÿ</h3>
<ol>
<li>
<p>LSP: Functions that use pointers of references to base classes must be able to use objects of derived classes without knowing it.</p>
<ol>
<li>è¿™ä¸ªåŸåˆ™æ¥æºäºæ›´æ—©å¦ä¸€ä¸ªå“¥ä»¬æå‡ºçš„ Liskov Substitution principle: If S is a subtype of T, then objects of type T may be replaced with objects of type S, without breaking program.</li>
</ol>
</li>
<li>
<p>å­ç±»å¯¹è±¡èƒ½å¤Ÿæ›¿æ¢ç¨‹åºä¸­çˆ¶ç±»å¯¹è±¡å‡ºç°çš„åœ°æ–¹ï¼Œå¹¶ä¸”ä¿è¯åŸæ¥ç¨‹åºçš„é€»è¾‘è¡Œä¸ºä¸å˜åŠæ­£ç¡®æ€§ä¸è¢«ç ´åã€‚ï¼ˆé‚£å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œæ›¿æ¢åä¸å°±ä¸è¡Œäº†ï¼Ÿå¤šæ€ï¼Ÿï¼‰</p>
</li>
<li>
<p>çœ‹ä¸ªä¾‹å­ï¼šçˆ¶ç±» Transporter ä½¿ç”¨ org.apache.http åº“ä¸­çš„ HttpClient ç±»æ¥ä¼ è¾“ç½‘ç»œæ•°æ®ã€‚å­ç±» SecurityTransporter ç»§æ‰¿çˆ¶ç±» Transporterï¼Œå¢åŠ äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæ”¯æŒä¼ è¾“ appId å’Œ appToken å®‰å…¨è®¤è¯ä¿¡æ¯ã€‚</p>
<pre><code class="language-java">public class Transporter {
  private HttpClient httpClient;
  
  public Transporter(HttpClient httpClient) {
    this.httpClient = httpClient;
  }

  public Response sendRequest(Request request) {
    // ...use httpClient to send request
  }
}

public class SecurityTransporter extends Transporter {
  private String appId;
  private String appToken;

  public SecurityTransporter(HttpClient httpClient, String appId, String appToken) {
    super(httpClient);
    this.appId = appId;
    this.appToken = appToken;
  }

  @Override
  public Response sendRequest(Request request) {
    if (StringUtils.isNotBlank(appId) &amp;&amp; StringUtils.isNotBlank(appToken)) {
      request.addPayload(&quot;app-id&quot;, appId);
      request.addPayload(&quot;app-token&quot;, appToken);
    }
    return super.sendRequest(request);
  }
}

public class Demo {    
  public void demoFunction(Transporter transporter) {    
    Reuqest request = new Request();
    //...çœç•¥è®¾ç½®requestä¸­æ•°æ®å€¼çš„ä»£ç ...
    Response response = transporter.sendRequest(request);
    //...çœç•¥å…¶ä»–é€»è¾‘...
  }
}

// é‡Œå¼æ›¿æ¢åŸåˆ™
Demo demo = new Demo();
demo.demofunction(new SecurityTransporter(/*çœç•¥å‚æ•°*/););
</code></pre>
</li>
</ol>
<p>â€‹		ä¸Šè¿°ä»£ç çœ‹èµ·æ¥ä¸è¿‡æ˜¯åˆ©ç”¨äº†å¤šæ€ï¼Œæ­£å¦‚æˆ‘åœ¨ç¬¬äºŒç‚¹ä¸­çš„ç–‘æƒ‘ä¸€æ ·ã€‚ <strong><u>ä½†æ˜¯å¤šæ€åªæ˜¯é¢å‘å¯¹è±¡çš„ä¸€ä¸ªç‰¹æ€§		èƒ½åŠ›ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è®¾è®¡å­ç±»çš„æ—¶å€™ï¼Œè¦éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</u></strong></p>
<ol start="4">
<li>
<p>å¦‚æœæˆ‘ä»¬åœ¨SecurityTranspoterä¸­sendRequestæ²¡æœ‰è®¾ç½®æˆ‘ä»¬ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<pre><code class="language-java">// æ”¹é€ å‰ï¼š
public class SecurityTransporter extends Transporter {
  //...çœç•¥å…¶ä»–ä»£ç ..
  @Override
  public Response sendRequest(Request request) {
    if (StringUtils.isNotBlank(appId) &amp;&amp; StringUtils.isNotBlank(appToken)) {
      request.addPayload(&quot;app-id&quot;, appId);
      request.addPayload(&quot;app-token&quot;, appToken);
    }
    return super.sendRequest(request);
  }
}

// æ”¹é€ åï¼š
public class SecurityTransporter extends Transporter {
  //...çœç•¥å…¶ä»–ä»£ç ..
  @Override
  public Response sendRequest(Request request) {
    if (StringUtils.isBlank(appId) || StringUtils.isBlank(appToken)) {
      throw new NoAuthorizationRuntimeException(...);
    }
    request.addPayload(&quot;app-id&quot;, appId);
    request.addPayload(&quot;app-token&quot;, appToken);
    return super.sendRequest(request);
  }
}
</code></pre>
<p>æ­¤æ—¶å°±è¿èƒŒäº†é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå­ç±»æ˜¯æ— æ³•æ›¿æ¢çˆ¶ç±»æ–¹æ³•çš„ã€‚å› ä¸ºåŸæ¥çš„çˆ¶ç±»æ–¹æ³•æœ¬èº«å°±æ²¡æœ‰appIdå’Œtokenï¼Œå¿…ç„¶ä¼šæŠ¥å¼‚å¸¸ã€‚è¿™ä¸ªç¨‹åºçš„é€»è¾‘æœ‰äº†å˜åŒ–ã€‚</p>
</li>
</ol>
<h3 id="å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº†é‡Œæ°æ›¿æ¢åŸåˆ™">å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº†é‡Œæ°æ›¿æ¢åŸåˆ™</h3>
<ol>
<li>LSPæœ‰å¦å¤–ä¸€ä¸ªæ›´è½åœ°çš„æè¿°ï¼šDesign by contract.</li>
<li>å­ç±»åœ¨è®¾è®¡çš„æ—¶å€™ï¼Œè¦éµå¾ªçˆ¶ç±»çš„è¡Œä¸ºçº¦å®šã€‚çˆ¶ç±»å®šä¹‰äº†å‡½æ•°çš„è¡Œä¸ºçº¦å®šï¼Œé‚£å­ç±»å¯ä»¥æ”¹å˜å‡½æ•°çš„å†…éƒ¨å®ç°é€»è¾‘ï¼Œä½†ä¸èƒ½æ”¹å˜å‡½æ•°åŸæœ‰çš„è¡Œä¸ºçº¦å®šã€‚è¿™é‡Œçš„è¡Œä¸ºçº¦å®šåŒ…æ‹¬ï¼šå‡½æ•°å£°æ˜è¦å®ç°çš„åŠŸèƒ½ï¼›å¯¹è¾“å…¥ã€è¾“å‡ºã€å¼‚å¸¸çš„çº¦å®šï¼›ç”šè‡³åŒ…æ‹¬æ³¨é‡Šä¸­æ‰€ç½—åˆ—çš„ä»»ä½•ç‰¹æ®Šè¯´æ˜ã€‚å®é™…ä¸Šï¼Œå®šä¹‰ä¸­çˆ¶ç±»å’Œå­ç±»ä¹‹é—´çš„å…³ç³»ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢æˆæ¥å£å’Œå®ç°ç±»ä¹‹é—´çš„å…³ç³»ã€‚</li>
</ol>
<h4 id="1-å­ç±»è¿èƒŒçˆ¶ç±»è¦å®ç°çš„åŠŸèƒ½">1. å­ç±»è¿èƒŒçˆ¶ç±»è¦å®ç°çš„åŠŸèƒ½</h4>
<p>æ¯”å¦‚çˆ¶ç±»æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯<code>sortOrdersByAmount()</code>ï¼Œæ˜¯æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§æ¥ç»™è®¢å•æ’åºçš„ï¼Œå„¿å­ç´¯å……å†™è¿™ä¸ªå‡½æ•°åæŒ‰ç…§åˆ›å»ºæ—¥æœŸæ’åºï¼Œé‚£å°±æ˜¯è¿èƒŒäº†LSPã€‚</p>
<h4 id="2-å­ç±»è¿èƒŒçˆ¶ç±»å¯¹è¾“å…¥-è¾“å‡º-å¼‚å¸¸çš„çº¦å®š">2. å­ç±»è¿èƒŒçˆ¶ç±»å¯¹è¾“å…¥ã€è¾“å‡ºã€å¼‚å¸¸çš„çº¦å®š</h4>
<p>çˆ¶ç±»æŸä¸ªå‡½æ•°è¿è¡Œå‡ºé”™è¿”å›nullï¼Œæ•°æ®ä¸ºç©ºè¿”å›ç©ºé›†åˆï¼›å­ç±»ä¸­é‡è½½ä¹‹åè¿è¡Œå‡ºé”™è¿”å›å¼‚å¸¸ï¼Œè·å–ä¸åˆ°æ•°æ®è¿”å›nullã€‚è¿™ä¹Ÿæ˜¯è¿èƒŒLSPã€‚</p>
<p>çˆ¶ç±»è¾“å…¥è¦æ±‚æ˜¯æ•´æ•°ï¼Œä½†æ˜¯å­ç±»åªå…è®¸æ­£æ•´æ•°ã€‚å¯¹è¾“å…¥æ›´åŠ ä¸¥æ ¼ï¼Œä¹Ÿæ˜¯è¿èƒŒäº†ã€‚</p>
<p>åœ¨çˆ¶ç±»çš„å‡½æ•°çº¦å®šç§ï¼Œåªä¼šæŠ›å‡º<code>ArgumentNullException</code>ä½†æ˜¯åœ¨å­ç±»ä¸­å¦‚æœæŠ›å‡ºå…¶ä»–å¼‚å¸¸çš„è¯ä¹Ÿæ˜¯è¿èƒŒLSPã€‚</p>
<h4 id="3-å­ç±»è¿èƒŒçˆ¶ç±»æ³¨é‡Šä¸­çš„è¯´æ˜">3. å­ç±»è¿èƒŒçˆ¶ç±»æ³¨é‡Šä¸­çš„è¯´æ˜</h4>
<p>çˆ¶ç±»ä¸­å®šä¹‰çš„ withdraw() æç°å‡½æ•°çš„æ³¨é‡Šæ˜¯è¿™ä¹ˆå†™çš„ï¼šâ€œç”¨æˆ·çš„æç°é‡‘é¢ä¸å¾—è¶…è¿‡è´¦æˆ·ä½™é¢â€¦â€¦â€ï¼Œè€Œå­ç±»é‡å†™ withdraw() å‡½æ•°ä¹‹åï¼Œé’ˆå¯¹ VIP è´¦å·å®ç°äº†é€æ”¯æç°çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æç°é‡‘é¢å¯ä»¥å¤§äºè´¦æˆ·ä½™é¢ï¼Œé‚£è¿™ä¸ªå­ç±»çš„è®¾è®¡ä¹Ÿæ˜¯ä¸ç¬¦åˆé‡Œå¼æ›¿æ¢åŸåˆ™çš„ã€‚</p>
<p>ä¸€ä¸ªå°æ–¹æ³•ï¼šç”¨å­ç±»çš„æ–¹æ³•å»è·‘çˆ¶ç±»çš„å•æµ‹ï¼Œæ²¡è·‘è¿‡çš„è¯å¯èƒ½è¯´æ˜æœ‰çš„å­ç±»è¿èƒŒäº†LSPã€‚</p>
<p>LSPæ˜¯ç”¨æ¥æŒ‡å¯¼ç»§æ‰¿ä¸­å­ç±»å¦‚ä½•å®ç°ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[240. Search a 2D Matrix II]]></title>
        <id>https://10kshuaizhang.github.io/post/240-search-a-2d-matrix-ii/</id>
        <link href="https://10kshuaizhang.github.io/post/240-search-a-2d-matrix-ii/">
        </link>
        <updated>2023-06-18T02:46:37.000Z</updated>
        <content type="html"><![CDATA[<h2 id="question">Question</h2>
<p>Write an efficient algorithm that searches for a value <code>target</code> in an <code>m x n</code> integer matrix <code>matrix</code>. This matrix has the following properties:</p>
<ul>
<li>Integers in each row are sorted in ascending from left to right.</li>
<li>Integers in each column are sorted in ascending from top to bottom.</li>
</ul>
<p><strong>Example 1:</strong></p>
<img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306181044231.jpg" alt="img" style="zoom:50%;" />
<p><strong>Constraints:</strong></p>
<ul>
<li><code>m == matrix.length</code></li>
<li><code>n == matrix[i].length</code></li>
<li><code>1 &lt;= n, m &lt;= 300</code></li>
<li><code>-109 &lt;= matrix[i][j] &lt;= 109</code></li>
<li>All the integers in each row are <strong>sorted</strong> in ascending order.</li>
<li>All the integers in each column are <strong>sorted</strong> in ascending order.</li>
<li><code>-109 &lt;= target &lt;= 109</code></li>
</ul>
<h2 id="algorithm">Algorithm</h2>
<p>Same walk through as a question 378.Kth Smallest Element in a Sorted Matrix but much easier.</p>
<p>You start from left bottom corner element, if it's larger than the target, you go up otherwise you go right.</p>
<h2 id="code">Code</h2>
<pre><code class="language-java">class Solution {
    public boolean searchMatrix(int[][] matrix, int target) {
        int m = matrix.length;
        int n = matrix[0].length;
        int i = m - 1, j = 0;
        while (i &gt;= 0 &amp;&amp; j &lt; n) {
            if (matrix[i][j] &gt; target) {
                i--;
            } else if (matrix[i][j] &lt; target) {
                j++;
            } else {
                return true;
            }
        }
        
        return false;
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°8-è®¾è®¡åŸåˆ™2-å¼€é—­åŸåˆ™(OCP)]]></title>
        <id>https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-8-she-ji-yuan-ze-2-kai-bi-yuan-ze/</id>
        <link href="https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-8-she-ji-yuan-ze-2-kai-bi-yuan-ze/">
        </link>
        <updated>2023-06-18T02:06:24.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç†è®ºäºŒå¦‚ä½•åšåˆ°å¯¹æ‰©å±•å¼€æ”¾-ä¿®æ”¹å…³é—­æ‰©å±•å’Œä¿®æ”¹å„æŒ‡ä»€ä¹ˆ">ç†è®ºäºŒï¼šå¦‚ä½•åšåˆ°â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿæ‰©å±•å’Œä¿®æ”¹å„æŒ‡ä»€ä¹ˆï¼Ÿ</h2>
<p>å¼€é—­åŸåˆ™æ¯”è¾ƒéš¾ç†è§£ï¼Œå› ä¸ºå…³äºæ‰©å±•ã€ä¿®æ”¹çš„å®šä¹‰æ¯”è¾ƒéš¾å®šä¹‰ã€‚ä»€ä¹ˆæ ·ç®—éµå®ˆï¼Œä»€ä¹ˆæ ·ç®—è¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</p>
<p>è¿™æ¡åŸåˆ™æ˜¯å…³äºæ‰©å±•æ€§ï¼Œè€Œæ‰©å±•æ€§æ˜¯è¡¡é‡ä»£ç è´¨é‡å¾ˆé‡è¦çš„æ ‡å‡†ã€‚23ç§ç»å…¸è®¾è®¡æ¨¡å¼ä¸­ï¼Œå¤§éƒ¨åˆ†è®¾è®¡æ¨¡å¼éƒ½æ˜¯ä¸ºäº†è§£å†³ä»£ç çš„æ‰©å±•æ€§é—®é¢˜å­˜åœ¨çš„ã€‚</p>
<h3 id="å¦‚ä½•ç†è§£å¯¹æ‰©å±•å¼€æ”¾-ä¿®æ”¹å…³é—­">å¦‚ä½•ç†è§£â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿ</h3>
<ol>
<li>
<p>å¼€é—­åŸåˆ™çš„è‹±æ–‡å…¨ç§°æ˜¯Open Closed Principleï¼ŒOCPã€‚ä»–çš„è‹±æ–‡æè¿°æ˜¯software entities(modules, classes, functions, etc.) should be open for extension, but closed for modification. è½¯ä»¶å®ä½“ï¼ˆæ¨¡å—ã€ç±»ã€æ–¹æ³•ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p>
<ol>
<li>è¯´å¾—æ˜ç™½ç‚¹å°±æ˜¯ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½åº”è¯¥æ˜¯åœ¨å·²æœ‰ä»£ç çš„åŸºç¡€ä¸Šæ‰©å±•ä»£ç ï¼ˆæ–°å¢æ¨¡å—ã€ç±»ã€æ–¹æ³•ï¼‰ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç ï¼ˆä¿®æ”¹æ¨¡å—ã€ç±»ã€æ–¹æ³•ï¼‰ã€‚</li>
</ol>
</li>
<li>
<p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p>
<ol>
<li>
<p>ä½œè€…ç»™äº†ä¸€æ®µAPIæ¥å£ç›‘æ§å‘Šè­¦çš„ä»£ç ã€‚å…¶ä¸­AlterRuleå­˜å‚¨è­¦å‘Šè§„åˆ™ï¼Œå¯ä»¥è‡ªç”±è®¾ç½®ã€‚Notification æ˜¯å‘Šè­¦é€šçŸ¥ç±»ï¼Œæ”¯æŒé‚®ä»¶ã€çŸ­ä¿¡ã€å¾®ä¿¡ã€æ‰‹æœºç­‰å¤šç§é€šçŸ¥æ¸ é“ã€‚NotificationEmergencyLevel è¡¨ç¤ºé€šçŸ¥çš„ç´§æ€¥ç¨‹åº¦ï¼ŒåŒ…æ‹¬ SEVEREï¼ˆä¸¥é‡ï¼‰ã€URGENCYï¼ˆç´§æ€¥ï¼‰ã€NORMALï¼ˆæ™®é€šï¼‰ã€TRIVIALï¼ˆæ— å…³ç´§è¦ï¼‰ï¼Œä¸åŒçš„ç´§æ€¥ç¨‹åº¦å¯¹åº”ä¸åŒçš„å‘é€æ¸ é“ã€‚</p>
<pre><code class="language-java">public class Alert {
  private AlertRule rule;
  private Notification notification;

  public Alert(AlertRule rule, Notification notification) {
    this.rule = rule;
    this.notification = notification;
  }

  public void check(String api, long requestCount, long errorCount, long durationOfSeconds) {
    long tps = requestCount / durationOfSeconds;
    if (tps &gt; rule.getMatchedRule(api).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
    if (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);
    }
  }
}
</code></pre>
</li>
<li>
<p>ç°åœ¨æˆ‘ä»¬è¦å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œå½“æ¯ç§’é’Ÿæ¥å£<u>è¶…æ—¶è¯·æ±‚ä¸ªæ•°è¶…è¿‡æœ€å¤§é˜ˆå€¼</u>ï¼Œä¹Ÿè¦è§¦å‘æŠ¥è­¦ã€‚ä¿®æ”¹ç‚¹åœ¨äºï¼š</p>
<ol>
<li>checkçš„å…¥å‚è¦å¢åŠ è¶…æ—¶è¯·æ±‚ä¸ªæ•°ï¼›</li>
<li>checkä¸­æ–°å¢ç›¸åº”çš„åˆ¤æ–­é€»è¾‘ã€‚</li>
</ol>
<pre><code class="language-java">public class Alert {
  // ...çœç•¥AlertRule/Notificationå±æ€§å’Œæ„é€ å‡½æ•°...
  
  // æ”¹åŠ¨ä¸€ï¼šæ·»åŠ å‚æ•°timeoutCount
  public void check(String api, long requestCount, long errorCount, long timeoutCount, long durationOfSeconds) {
    long tps = requestCount / durationOfSeconds;
    if (tps &gt; rule.getMatchedRule(api).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
    if (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);
    }
    // æ”¹åŠ¨äºŒï¼šæ·»åŠ æ¥å£è¶…æ—¶å¤„ç†é€»è¾‘
    long timeoutTps = timeoutCount / durationOfSeconds;
    if (timeoutTps &gt; rule.getMatchedRule(api).getMaxTimeoutTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
  }
}
</code></pre>
</li>
<li>
<p>è¿™æ ·çš„è®¾è®¡å’Œä¿®æ”¹çš„é—®é¢˜åœ¨äº<u>æ‰€æœ‰ä½¿ç”¨åˆ°è¿™ä¸ªæ–¹æ³•çš„åœ°æ–¹éƒ½è¦ä¿®æ”¹ã€‚æ‰€æœ‰çš„å•æµ‹ä¹Ÿéœ€è¦ç›¸åº”çš„ä¿®æ”¹ã€‚</u></p>
</li>
<li>
<p>è¿™æ ·çš„æ”¹åŠ¨æ˜¯åŸºäºâ€œä¿®æ”¹â€æ¥å®ç°çš„ã€‚æˆ‘ä»¬å°†éµå¾ªå¼€é—­åŸåˆ™ï¼Œä»¥æ˜“æ‰©å±•çš„æ–¹å¼è®¾è®¡å’Œå®ç°ä¿®æ”¹ã€‚</p>
</li>
<li>
<p>é¦–å…ˆé‡æ„ä¸€ä¸‹ä¹‹å‰çš„Alertä»£ç </p>
<ol>
<li>å°†checkçš„å¤šä¸ªå…¥å‚ç­‰è£…æˆApiStateInfoç±»ï¼›</li>
<li>å¼•å…¥handlerçš„æ¦‚å¿µï¼Œå°†ifåˆ¤æ–­é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªhandlerä¸­ã€‚</li>
</ol>
<pre><code class="language-java">public class Alert {
  private List&lt;AlertHandler&gt; alertHandlers = new ArrayList&lt;&gt;();
  
  public void addAlertHandler(AlertHandler alertHandler) {
    this.alertHandlers.add(alertHandler);
  }

  public void check(ApiStatInfo apiStatInfo) {
    for (AlertHandler handler : alertHandlers) {
      handler.check(apiStatInfo);
    }
  }
}

public class ApiStatInfo {//çœç•¥constructor/getter/setteræ–¹æ³•
  private String api;
  private long requestCount;
  private long errorCount;
  private long durationOfSeconds;
}

public abstract class AlertHandler {
  protected AlertRule rule;
  protected Notification notification;
  public AlertHandler(AlertRule rule, Notification notification) {
    this.rule = rule;
    this.notification = notification;
  }
  public abstract void check(ApiStatInfo apiStatInfo);
}

public class TpsAlertHandler extends AlertHandler {
  public TpsAlertHandler(AlertRule rule, Notification notification) {
    super(rule, notification);
  }

  @Override
  public void check(ApiStatInfo apiStatInfo) {
    long tps = apiStatInfo.getRequestCount()/ apiStatInfo.getDurationOfSeconds();
    if (tps &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
  }
}

public class ErrorAlertHandler extends AlertHandler {
  public ErrorAlertHandler(AlertRule rule, Notification notification){
    super(rule, notification);
  }

  @Override
  public void check(ApiStatInfo apiStatInfo) {
    if (apiStatInfo.getErrorCount() &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);
    }
  }
}
</code></pre>
</li>
<li>
<p>ä½¿ç”¨Alertã€‚ApplicationContext æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè´Ÿè´£ Alert çš„åˆ›å»ºã€ç»„è£…ï¼ˆalertRule å’Œ notification çš„ä¾èµ–æ³¨å…¥ï¼‰ã€åˆå§‹åŒ–ï¼ˆæ·»åŠ  handlersï¼‰å·¥ä½œã€‚å•ä¾‹ç›¸å½“äºç»™Alert featureçš„è°ƒç”¨æä¾›ä¸€ä¸ªæŠ“æ‰‹ã€å…¥å£ã€‚</p>
<pre><code class="language-java">public class ApplicationContext {
  private AlertRule alertRule;
  private Notification notification;
  private Alert alert;
  
  public void initializeBeans() {
    alertRule = new AlertRule(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    notification = new Notification(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    alert = new Alert();
    alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));
    alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));
  }
  public Alert getAlert() { return alert; }

  // é¥¿æ±‰å¼å•ä¾‹
  private static final ApplicationContext instance = new ApplicationContext();
  private ApplicationContext() {
    initializeBeans();
  }
  public static ApplicationContext getInstance() {
    return instance;
  }
}

public class Demo {
  public static void main(String[] args) {
    ApiStatInfo apiStatInfo = new ApiStatInfo();
    // ...çœç•¥è®¾ç½®apiStatInfoæ•°æ®å€¼çš„ä»£ç 
    ApplicationContext.getInstance().getAlert().check(apiStatInfo);
  }
}
</code></pre>
</li>
<li>
<p>å†è¿›è¡Œä¹‹å‰è¯´çš„æ”¹åŠ¨ï¼Œå¯¹äºæ¯ç§’é’Ÿæ¥å£è¶…æ—¶è¯·æ±‚ä¸ªæ•°è¶…è¿‡æŸä¸ªæœ€å¤§é˜ˆå€¼å°±å‘Šè­¦ã€‚</p>
<ol>
<li>ç»™ApiStatInfoç±»å¢åŠ ä¸€ä¸ªå±æ€§ï¼šè¶…æ—¶è¯·æ±‚ä¸ªæ•°timeOutCount;</li>
<li>å¢åŠ ä¸€ä¸ªhandlerï¼Œåœ¨è¿™ä¸ªhandlerä¸­çš„checkæ–¹æ³•å®ç°è¿™ä¸ªå‘Šè­¦è§„åˆ™ï¼›</li>
<li>å†initializebeanï¼ˆapplication context)çš„æ—¶å€™ç»™å•ä¾‹çš„alteræ·»åŠ ä¸Šè¿™ä¸ªhandlerã€‚</li>
<li>ä½¿ç”¨alterçš„æ—¶å€™ï¼Œç»™checkå‡½æ•°çš„å…¥å‚apiStatInfoå¯¹è±¡è®¾ç½®ç›¸åº”çš„timeOutCountå€¼ã€‚</li>
</ol>
<p>è¿™æ ·åŸºäºæ‰©å±•å¢åŠ äº†æ–°çš„handlerï¼Œä¸éœ€è¦æ”¹åŠ¨åŸæ¥çš„checké€»è¾‘ï¼Œä¹Ÿåªéœ€è¦ä¸ºæ–°çš„handlerå¢åŠ å•æµ‹ï¼Œä»¥å‰çš„ä¸ä¼šå¤±æ•ˆã€‚</p>
<pre><code class="language-java">public class Alert { // ä»£ç æœªæ”¹åŠ¨... }
public class ApiStatInfo {//çœç•¥constructor/getter/setteræ–¹æ³•
  private String api;
  private long requestCount;
  private long errorCount;
  private long durationOfSeconds;
  private long timeoutCount; // æ”¹åŠ¨ä¸€ï¼šæ·»åŠ æ–°å­—æ®µ
}
public abstract class AlertHandler { //ä»£ç æœªæ”¹åŠ¨... }
public class TpsAlertHandler extends AlertHandler {//ä»£ç æœªæ”¹åŠ¨...}
public class ErrorAlertHandler extends AlertHandler {//ä»£ç æœªæ”¹åŠ¨...}
// æ”¹åŠ¨äºŒï¼šæ·»åŠ æ–°çš„handler
public class TimeoutAlertHandler extends AlertHandler {//çœç•¥ä»£ç ...}

public class ApplicationContext {
  private AlertRule alertRule;
  private Notification notification;
  private Alert alert;
  
  public void initializeBeans() {
    alertRule = new AlertRule(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    notification = new Notification(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    alert = new Alert();
    alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));
    alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));
    // æ”¹åŠ¨ä¸‰ï¼šæ³¨å†Œhandler
    alert.addAlertHandler(new TimeoutAlertHandler(alertRule, notification));
  }
  //...çœç•¥å…¶ä»–æœªæ”¹åŠ¨ä»£ç ...
}

public class Demo {
  public static void main(String[] args) {
    ApiStatInfo apiStatInfo = new ApiStatInfo();
    // ...çœç•¥apiStatInfoçš„setå­—æ®µä»£ç 
    apiStatInfo.setTimeoutCount(289); // æ”¹åŠ¨å››ï¼šè®¾ç½®tiemoutCountå€¼
    ApplicationContext.getInstance().getAlert().check(apiStatInfo);
}
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="ä¿®æ”¹ä»£ç æ„å‘³ç€è¿åå¼€é—­åŸåˆ™å—">ä¿®æ”¹ä»£ç æ„å‘³ç€è¿åå¼€é—­åŸåˆ™å—</h3>
<p>ä¸Šè¿°ä¿®æ”¹çš„1/3/4ä¸éƒ½æ˜¯åœ¨ä¿®æ”¹äº†åŸæ¥çš„ä»£ç å—ï¼Ÿè®©æˆ‘ä»¬ä¸€ä¸ªä¸ªåˆ†æï¼š</p>
<ol>
<li>
<p>å¾€ApiStateInfoä¸­å¢åŠ æ–°çš„å±æ€§timeOutCount</p>
<ul>
<li>
<p>æˆ‘ä»¬ä¸ä»…å¢åŠ äº†æ–°çš„å±æ€§ï¼Œè¿˜å¢åŠ äº†getterã€Setterã€‚</p>
</li>
<li>
<p>åœ¨â€ç±»â€œçš„ç²’åº¦ä¸Šæˆ‘ä»¬æ˜¯åœ¨ä¿®æ”¹ç±»ï¼Œå¢åŠ äº†æ–°çš„å±æ€§ï¼›ä½†æ˜¯åœ¨â€æ–¹æ³•â€œçš„ç²’åº¦ä¸Šï¼Œæˆ‘ä»¬æ²¡æœ‰æ”¹å˜ç°æœ‰çš„å…¶ä»–æ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªå¢åŠ åˆå¯ä»¥æ˜¯æ‹“æ‰©å±•</p>
</li>
<li>
<p>æˆ‘ä»¬ä¸éœ€è¦çº ç»“ï¼ˆæˆ‘è®¤åŒï¼Œä¸éœ€è¦çº ç»“æ¦‚å¿µï¼‰ä»–æ˜¯ä¿®æ”¹è¿˜æ˜¯æ‰©å±•ã€‚å›åˆ°è¿™ä¸ªåŸåˆ™çš„è®¾è®¡åˆè¡·å°±æ˜¯**<u>æ²¡æœ‰ç ´ååŸæœ‰ä»£ç çš„è¿è¡Œï¼Œæ²¡æœ‰ç ´åå•æµ‹ã€‚</u>**</p>
</li>
</ul>
</li>
<li>
<p>æ”¹åŠ¨3ã€4ã€‚è™½ç„¶åœ¨å„ä¸ªå±‚é¢éƒ½æ˜¯ä¿®æ”¹ï¼Œä½†æ˜¯ä»–ä»¬æ˜¯ä¸å¯é¿å…çš„ï¼Œ<u>æ˜¯å¯ä»¥æ¥å—çš„ã€‚</u></p>
<ul>
<li>
<p>æˆ‘ä»¬è¦è®¤è¯†åˆ°ï¼Œæ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä¸å¯èƒ½ä»»ä½•æ¨¡å—ã€ç±»ã€æ–¹æ³•çš„ä»£ç éƒ½ä¸â€œä¿®æ”¹â€ï¼Œè¿™ä¸ªæ˜¯åšä¸åˆ°çš„ã€‚ç±»éœ€è¦åˆ›å»ºã€ç»„è£…ã€å¹¶ä¸”åšä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ‰èƒ½æ„å»ºæˆå¯è¿è¡Œçš„çš„ç¨‹åºï¼Œè¿™éƒ¨åˆ†ä»£ç çš„ä¿®æ”¹æ˜¯åœ¨æ‰€éš¾å…çš„ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯å°½é‡è®©ä¿®æ”¹æ“ä½œæ›´é›†ä¸­ã€æ›´å°‘ã€æ›´ä¸Šå±‚ï¼Œå°½é‡è®©æœ€æ ¸å¿ƒã€æœ€å¤æ‚çš„é‚£éƒ¨åˆ†é€»è¾‘ä»£ç æ»¡è¶³å¼€é—­åŸåˆ™ã€‚</p>
<blockquote>
<p>ç»†ææœ«èŠ‚å› ä¸ºjavaçš„è¯­æ³•å’Œä»£ç è®¾è®¡è‚¯å®šéœ€è¦å¢å¼ºå’Œä¿®æ”¹ï¼Œä½†æ˜¯åŸæ¥çš„æ ¸å¿ƒé€»è¾‘æ˜¯æ²¡æœ‰åŠ¨çš„ï¼Œå°±æ˜¯å¢åŠ äº†ä¸€ä¸ªhandlerå¤„ç†æ–°çš„é€»è¾‘ã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h3 id="å¦‚ä½•åšåˆ°å¯¹æ‰©å±•å¼€æ”¾-ä¿®æ”¹å…³é—­">å¦‚ä½•åšåˆ°â€å¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€œ</h3>
<ol>
<li>
<p>æˆ‘ä¸€å¼€å§‹ç¡®å®æƒ³ä¸åˆ°è®¾è®¡handlerã€‚ç¬”è€…ä¹Ÿè¯´äº†æ…¢æ…¢ç§¯ç´¯ç»éªŒã€‚</p>
</li>
<li>
<p><strong>æ—¶åˆ»å…·å¤‡æ‰©å±•æ„è¯†ï¼ŒæŠ½è±¡æ„è¯†ï¼Œå°è£…æ„è¯†</strong></p>
</li>
<li>
<p>åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œè¦èŠ±æ—¶é—´å¤šå¾€åæ€è€ƒè¿™æ®µä»£ç å¯èƒ½ä¼šæœ‰å“ªäº›éœ€æ±‚å˜æ›´ã€å¦‚ä½•è®¾è®¡ä»£ç ç»“æ„ï¼Œäº‹å…ˆç•™å¥½æ‰©å±•ç‚¹ï¼Œä»¥ä¾¿åœ¨æœªæ¥éœ€æ±‚å˜æ›´æ—¶å€™ä¸éœ€è¦æ”¹åŠ¨ä»£ç æ•´ä½“ç»“æ„ã€‚åšåˆ°æœ€å°ä»£ç è®¾è®¡æ”¹åŠ¨æƒ…å†µä¸‹ï¼Œæ–°ä»£ç å¾ˆçµæ´»çš„æ’å…¥åˆ°æ‰©å±•ç‚¹ã€‚</p>
</li>
<li>
<p>åœ¨è¯†åˆ«ä»£ç çš„å¯å˜éƒ¨åˆ†å’Œä¸å¯å˜éƒ¨åˆ†åï¼Œæˆ‘ä»¬è¦å°†å¯å˜éƒ¨åˆ†å°è£…èµ·æ¥ï¼Œéš”ç¦»å˜åŒ–ï¼Œæä¾›æŠ½è±¡åŒ–çš„ä¸å¯å˜æ¥å£ç»™ä¸Šå±‚ä½¿ç”¨ã€‚</p>
</li>
<li>
<p>åœ¨ä¼—å¤šè®¾è®¡åŸåˆ™ï¼Œæ€æƒ³ï¼Œæ¨¡å¼ä¸­ï¼Œæœ€å¸¸ç”¨æ¥æé«˜ä»£ç æ‰©å±•æ€§çš„æ–¹æ³•æœ‰ï¼šå¤šæ€ã€ä¾èµ–æ³¨å…¥ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä»¥åŠå¤§éƒ¨åˆ†è®¾è®¡æ¨¡å¼ï¼ˆåé¢è¯¦ç»†è¯´ï¼‰ã€‚</p>
<ol>
<li>
<p>å¤šæ€ã€ä¾èµ–æ³¨å…¥ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹éƒ½æ˜¯åŒä¸€ä¸ªå“²å­¦ï¼ˆæˆ–è€…è¯´æ€è·¯ï¼‰ï¼Œåªæ˜¯ä»ä¸åŒè§’åº¦é˜è¿°ã€‚</p>
</li>
<li>
<p>æ¥ä¸ªä¾‹å­ï¼šæˆ‘ä»¬é€šè¿‡Kafkaå‘é€å¼‚æ­¥æ¶ˆæ¯ã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªåŠŸèƒ½çš„å¼€å‘ä¸­æˆ‘ä»¬è¦å­¦ä¼šå°†å…¶æŠ½è±¡æˆä¸€ç»„è·Ÿå…·ä½“æ¶ˆæ¯é˜Ÿåˆ—æ— å…³çš„å¼‚æ­¥æ¶ˆæ¯æ¥å£ã€‚ä»¥ä¾¿æˆ‘ä»¬åœ¨ä»¥åç”¨RabbitMQæ›¿æ¢Kafkaçš„æ—¶å€™å¾ˆæ–¹ä¾¿ã€‚</p>
<pre><code class="language-java">// è¿™ä¸€éƒ¨åˆ†ä½“ç°äº†æŠ½è±¡æ„è¯†
public interface MessageQueue { //... }
public class KafkaMessageQueue implements MessageQueue { //... }
public class RocketMQMessageQueue implements MessageQueue {//...}

public interface MessageFromatter { //... }
public class JsonMessageFromatter implements MessageFromatter {//...}
public class ProtoBufMessageFromatter implements MessageFromatter {//...}

public class Demo {
  private MessageQueue msgQueue; // åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹
  public Demo(MessageQueue msgQueue) { // ä¾èµ–æ³¨å…¥
    this.msgQueue = msgQueue;
  }
  
  // msgFormatterï¼šå¤šæ€ã€ä¾èµ–æ³¨å…¥
  public void sendNotification(Notification notification, MessageFormatter msgFormatter) {
    //...    
  }
}
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨è¿™ä¸ªåŸåˆ™">å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨è¿™ä¸ªåŸåˆ™ï¼Ÿ</h3>
<ol>
<li><strong><u>å¦‚ä½•è¯†åˆ«æ‰©å±•ç‚¹</u></strong>ï¼š
<ol>
<li>å¦‚æœæ˜¯ä¸šåŠ¡å¯¼å‘çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦å°½å¯èƒ½äº†è§£ä¸šåŠ¡ï¼Œèƒ½å¤ŸçŸ¥é“å½“ä¸‹æœªæ¥å¯èƒ½éœ€è¦æ”¯æŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚</li>
<li>å¦‚æœæ˜¯è·Ÿä¸šåŠ¡æ— å…³çš„ååº•å±‚çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ¡†æ¶ç»„ä»¶ç±»åº“ç­‰ï¼Œä½ éœ€è¦äº†è§£ä»–ä»¬å¯èƒ½ä¼šå¦‚ä½•è¢«ä½¿ç”¨ï¼Œæ‰“ç®—æ·»åŠ ä»€ä¹ˆåŠŸèƒ½ï¼Œä½¿ç”¨è€…æœªæ¥å¯èƒ½ä¼šæœ‰ä»€ä¹ˆéœ€æ±‚ï¼Ÿ</li>
</ol>
</li>
<li>ä¸è¿‡è¿˜æ˜¯è¦é€‚åº¦ï¼Œé¿å…è¿‡åº¦è®¾è®¡ã€‚</li>
<li>æ‰€ä»¥å¯¹äºä¸€äº›æ¯”è¾ƒç¡®å®šçš„ã€çŸ­æœŸèƒ½å¯èƒ½æ‰©å±•ï¼Œæˆ–è€…éœ€æ±‚æ”¹åŠ¨å¯¹ä»£ç ç»“æ„å½±å“æ¯”è¾ƒå¤§çš„æƒ…å†µï¼Œæˆ–è€…æ˜¯å®ç°æˆæœ¬ä¸é«˜çš„æ‰©å±•ç‚¹ï¼Œåœ¨å†™ä»£ç çš„æ—¶å€™å¯ä»¥æ˜¯å…ˆåšæ‰©å±•æ€§è®¾è®¡ã€‚</li>
<li>ä½†æ˜¯å¯¹äºä¸ç¡®å®šæœªæ¥è¦æ”¯æŒçš„éœ€æ±‚ï¼Œæ‰©å±•æ¯”è¾ƒå¤æ‚çš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥ç­‰éœ€æ±‚é©±åŠ¨å†å»åšé€šè¿‡é‡æ„çš„æ–¹å¼æ¥æ”¯æŒæ‰©å±•ã€‚</li>
<li>æ‰©å±•å¯èƒ½ä¼šå’Œå¯è¯»æ€§å†²çªã€‚Alertä»£ç åœ¨è€ƒè™‘è¿‡æ‰©å±•æ€§ä¹‹åçš„é‡æ„è®¾è®¡å’Œç†è§£ä¸Šéƒ½å¢åŠ äº†ä¸€äº›éš¾åº¦ã€‚æˆ‘ä»¬éœ€è¦åšä¸€äº›æƒè¡¡ã€‚</li>
</ol>
<p>æˆ‘ä¹‹å‰å¯¹äºä¸€äº›å¥½ä»£ç çš„ç†è§£å•çº¯æ˜¯DRYï¼Œä¹Ÿå°±æ˜¯ä¸é‡å¤çš„ä»£ç ã€‚è¿™ä¸ªæ€è·¯æ²¡é”™ä½†æ˜¯ç°åœ¨çœ‹æ¥æœ‰ç‚¹åˆé˜¶æˆ–è€…æ˜¯æµ…æ˜¾äº†ã€‚ä¹‹å‰ä¸€ä¸ªéœ€æ±‚å°±æ˜¯å¯¹äºå¤šä¸ªObjectå¢åŠ ä¸€ä¸ªæ–°çš„unique idï¼Œç„¶åè¦å¯¹ä»–ä»¬çš„æ ¼å¼å’Œå”¯ä¸€æ€§åšæ ¡éªŒã€‚æœ€å¼€å§‹çš„è®¾è®¡å’Œå®ç°æ˜¯åœ¨æ¯ä¸ªObjectçš„managerçš„saveæ–¹æ³•ä¸­å»å®ç°äº†è¿™ä¸ªvalidatorï¼Œå…¶å®æ¯ä¸ªvalidatorçš„è§†çº¿é€»è¾‘å¤§æ¦‚æœ‰80%ç›¸ä¼¼ï¼Œä½†æ˜¯æ“ä½œçš„Objectä¸åŒï¼Œæ ¡éªŒé€»è¾‘å¤§æ¦‚æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚</p>
<p>åé¢å°±åœ¨ä¸€åˆ°ä¸¤å‘¨åæœ‰äº†ç‚¹æ—¶é—´ï¼Œåœ¨åšè¿™ä¸ªfunctionçš„testçš„æ—¶å€™åšäº†é‡æ„ï¼Œè¿™æ¬¡é‡æ„æ˜¯é’ˆå¯¹çš„é‡å¤ä»£ç ï¼ŒæŠŠè¿™äº›validationçš„é€»è¾‘ä»æ¯ä¸ªObjectçš„managerä¸­æŠ½ç¦»å‡ºæ¥ï¼Œåšäº†ä¸€ä¸ªvalidatorç±»ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªé™æ€çš„validationæ–¹æ³•ï¼Œé’ˆå¯¹ä¼ è¿›æ¥çš„å‚æ•°ç±»å‹ç¡®å®šä½¿ç”¨ä¸åŒçš„æ ¡éªŒç»†èŠ‚çš„å¢å‡ï¼Œè¿™æ ·ä¸€ä¸‹å­å°†ä»£ç é›†ä¸­ï¼Œå˜å¾—æ›´å¥½ç»´æŠ¤ï¼Œè€Œä¸”ä¹Ÿå‡å°‘äº†ä»£ç é‡ï¼Œæå‡äº†å¯è¯»æ€§ã€‚</p>
<p>ä½†å½“æ—¶reviewä»£ç çš„åŒäº‹å°±æå‡ºäº†ä¸€ä¸ªå»ºè®®å°±æ˜¯è¯´å¦‚æœè€ƒè™‘åˆ°æ•´ä¸ªä»£ç çš„å¯æ‰©å±•æ€§ï¼Œä»¥åå¦‚æœè¿˜è¦ç»™å…¶ä»–çš„objectå¢åŠ è¿™ä¸ªunique idä»¥åŠç±»ä¼¼çš„æ ¡éªŒé€»è¾‘ï¼Œè¿˜æ˜¯ä¼šå›æ¥æ”¹è¿™ä¸ªvalidatorã€‚è¿™æ ·å…¶å®æ˜¯è¿åäº†OCPã€‚</p>
<p>æˆ‘å½“æ—¶å…¶å®æƒ³åˆ°äº†å°†æ‰€æœ‰çš„ä¸œè¥¿æ”¾è¿›å»ä¸€ä¸ªvalidatorçš„â€å¼Šç«¯â€œï¼šé›†ä¸­äº†ä¿®æ”¹ã€‚ä½†æ˜¯è€ƒè™‘åˆ°è¿™ä¸ªéœ€æ±‚ä»¥åå¯èƒ½å¯¹äºæˆ‘ä»¬ç°æœ‰çš„objectå·²ç»è¶³å¤Ÿï¼Œä»¥åå¢åŠ å…¶ä»–çš„objectï¼ˆæœªçŸ¥ï¼‰ã€‚</p>
<p>ç»è¿‡ä»–çš„ä»‹ç»ï¼Œå†åŠ ä¸Šåˆçœ‹äº†è¿™ä¸ªæ–‡ç« ï¼Œæ¯”è¾ƒæ¸…æ™°çš„æ„è¯†åˆ°é—®é¢˜æ‰€åœ¨ã€‚</p>
<p>å¦‚æœè¦å¯¹é‚£ä¸ªä»£ç é‡æ„ï¼Œä½¿å…¶æ›´åŠ å…·æœ‰å¯æ‰©å±•æ€§ï¼Œæˆ‘ä¹‹å‰åŒäº‹è¯´çš„æ˜¯ï¼šâ€splitting it into a base class along with a set of different subclassesâ€œã€‚æˆ‘ç†è§£æˆ–è€…è¯´ç°åœ¨å¯ä»¥æƒ³åˆ°çš„ï¼š</p>
<ol>
<li>åšä¸€ä¸ªæŠ½è±¡ç±»åŒ…å«é€šç”¨çš„éƒ¨åˆ†ï¼›</li>
<li>æ¯ä¸ªä¸åŒçš„objectå»ç»§æ‰¿è¿™ä¸ªç±»ï¼Œé’ˆå¯¹è‡ªå·±çš„é€»è¾‘å¢åŠ ç‰¹å®šæ–¹æ³•ï¼›</li>
<li>ç„¶åå†åœ¨ä½¿ç”¨çš„åœ°æ–¹è°ƒç”¨è¿™äº›æ–¹æ³•å³å¯ï¼›</li>
</ol>
<p>è¿™æ ·åœ¨å¢åŠ å…¶ä»–çš„objectéœ€è¦ä½¿ç”¨ç±»ä¼¼çš„åŒæ ·å¯ä»¥ç»§æ‰¿é€šç”¨çš„éƒ¨åˆ†ï¼Œç„¶åä¾é å¤šæ€åœ¨è‡ªå·±çš„xxxObjectValidatorç±»ä¸­å»å®ç°è‡ªå·±çš„é€»è¾‘ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°7-è®¾è®¡åŸåˆ™1-å•ä¸€èŒè´£(SRP)]]></title>
        <id>https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-7-she-ji-yuan-ze-1-solid/</id>
        <link href="https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-7-she-ji-yuan-ze-1-solid/">
        </link>
        <updated>2023-06-16T03:56:24.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç†è®ºä¸€å¯¹äºå•ä¸€èŒè´£åŸåˆ™å¦‚ä½•åˆ¤å®šæŸä¸ªç±»çš„èŒè´£æ˜¯å¦å¤Ÿå•ä¸€">ç†è®ºä¸€ï¼šå¯¹äºå•ä¸€èŒè´£åŸåˆ™ï¼Œå¦‚ä½•åˆ¤å®šæŸä¸ªç±»çš„èŒè´£æ˜¯å¦å¤Ÿâ€œå•ä¸€â€ï¼Ÿ</h2>
<h3 id="å¦‚ä½•ç†è§£å•ä¸€èŒè´£åŸåˆ™srp">å¦‚ä½•ç†è§£å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRP)</h3>
<ol>
<li>å•ä¸€èŒè´£åŸåˆ™:Single responsibility Principle, SRP. A class or module should have a single responsibility. ä¸€ä¸ªç±»æˆ–æ¨¡å—åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£ï¼ˆæˆ–è€…åŠŸèƒ½ï¼‰ã€‚å…³äºæ¨¡å—å’Œç±»æœ‰ä¸¤ç§ç†è§£ï¼š
<ol>
<li>æ¨¡å—å¯ä»¥çœ‹åšæ›´æŠ½è±¡çš„ç±»ï¼Œç±»ä¹Ÿå¯çœ‹æˆä¸€ä¸ªæ¨¡å—ã€‚</li>
<li>æ¨¡å—å¯ä»¥çœ‹åšæ›´ç²—ç²’åº¦çš„ä»£ç å—ï¼ŒåŒ…å«å¤šä¸ªç±»ã€‚</li>
</ol>
</li>
<li>è§£è¯»å°±æ˜¯ä¸è¦è®¾è®¡å¤§è€Œå…¨çš„ç±»ï¼Œè¦è®¾è®¡ç²’åº¦å°ï¼ŒåŠŸèƒ½å•ä¸€çš„ç±»ã€‚æ¯”å¦‚ä¸€ä¸ªç±»æ—¢åŒ…å«è®¢å•çš„æ“ä½œï¼ŒåˆåŒ…å«ç”¨æˆ·çš„æ“ä½œï¼Œä»–ä»¬ï¼ˆç”¨æˆ·å’Œè®¢å•ï¼‰æ˜¯ä¸åŒçš„é¢†åŸŸæ¨¡å‹ï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¶æ‹†åˆ†ã€‚</li>
</ol>
<h3 id="å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£è¶³å¤Ÿå•ä¸€">å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£è¶³å¤Ÿå•ä¸€</h3>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªç¤¾äº¤äº§å“ï¼Œå…¶ä¸­UserInfoç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä»¥ä¸‹è¿™ä¸ªç±»æ˜¯å¦æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼š</p>
<pre><code class="language-java">public class UserInfo {
  private long userId;
  private String username;
  private String email;
  private String telephone;
  private long createTime;
  private long lastLoginTime;
  private String avatarUrl;
  private String provinceOfAddress; // çœ
  private String cityOfAddress; // å¸‚
  private String regionOfAddress; // åŒº 
  private String detailedAddress; // è¯¦ç»†åœ°å€
  // ...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...
}
</code></pre>
<blockquote>
<p>åæ­£æˆ‘çœ‹ç€å±æ€§æœ‰ç‚¹å¤šï¼Œä¸‹é¢çš„çœå¸‚åŒºè¯¦ç»†åœ°å€å¯ä»¥æ‹†æˆå¦ä¸€ä¸ªç±»ã€‚</p>
</blockquote>
<p>ä½œè€…æä¾›çš„ä¸¤ä¸ªè§‚ç‚¹ï¼š1æ˜¯å’Œæˆ‘çš„ä¸€æ ·ï¼Œåœ°å€ä¿¡æ¯å æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ç»§ç»­æ‹†åˆ†æˆç‹¬ç«‹çš„UserAddressç±»ï¼ŒUserInfoåªä¿ç•™åœ°å€ä»¥å¤–çš„ä¿¡æ¯ã€‚2. æ˜¯æ‰€æœ‰çš„ä¿¡æ¯éƒ½æ˜¯ç”¨æˆ·ç›¸å…³çš„ï¼Œæ‰€ä»¥æ»¡è¶³SRPã€‚</p>
<ol>
<li><strong>ç»“åˆå®é™…çš„åº”ç”¨ä¸šåŠ¡åœºæ™¯</strong>ã€‚å¦‚ä½•åœ°å€ä¿¡æ¯åªæ˜¯å•çº¯çš„ç”¨æ¥å±•ç¤ºçš„ï¼Œå’Œå…¶ä»–çš„å±æ€§ä¸€æ ·ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿ç•™åœ¨UserInfoä¸­ã€‚ä½†æ˜¯å¦‚æœä¸šåŠ¡åœ¨æ‹“å±•ï¼Œæœ‰äº†ç”µå•†æ¨¡å—ï¼Œç”¨æˆ·çš„åœ°å€ä¿¡æ¯è¿˜ä¼šç”¨åœ¨ç”µå•†ç‰©æµä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€å¥½å°†å…¶åˆ†ç¦»å‡ºæ¥ï¼Œç‹¬ç«‹æˆç‰©æµä¿¡æ¯ã€‚</li>
<li>å¦‚æœä¸šåŠ¡ç»§ç»­å‘å±•ï¼Œè¿™ä¸ªå…¬å¸å¼€å‘å‡ºæ¥å…¶ä»–çš„ä¸€äº›åº”ç”¨ï¼Œå…¬å¸å¸Œæœ›æ”¯æŒç»Ÿä¸€è´¦å·ç³»ç»Ÿï¼ˆä¸€ä¸ªè´¦å·å¯ä»¥ç™»é™†æ——ä¸‹æ‰€æœ‰appï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦å¯¹UserInfoç»§ç»­æ‹†åˆ†ï¼Œå°†èº«ä»½è®¤è¯çš„ä¿¡æ¯ä¾‹å¦‚emailï¼Œ phoneæŠ½å–æˆç‹¬ç«‹çš„çš„ç±»ã€‚</li>
<li>ä¸åŒçš„åº”ç”¨åœºæ™¯ã€ä¸åŒé˜¶æ®µçš„éœ€æ±‚èƒŒæ™¯ä¸‹ï¼Œå¯¹ä¸€ä¸ªç±»çš„å•ä¸€èŒè´£åˆ¤å®šæ˜¯ä¸åŒçš„ã€‚</li>
<li>åœ¨å®é™…å¼€å‘ä¸­ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥å…ˆå†™ä¸€ä¸ªç²—ç²’åº¦çš„ç±»ï¼Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚éšç€ä¸šåŠ¡å‘å±•ï¼Œå¦‚æœç²—ç²’åº¦çš„ç±»è¶Šæ¥è¶Šåºå¤§ï¼Œä»£ç è¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬é‚£å°±å¯ä»¥å°†è¿™ä¸ªç±»æ‹†åˆ†æˆå‡ ä¸ªæ›´ç»†ç²’åº¦çš„ç±»ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æŒç»­é‡æ„ã€‚</strong></li>
<li>ä¸ºä»€ä¹ˆåšæ‹†åˆ†
<ol>
<li>ç±»ä¸­çš„ä»£ç è¡Œæ•°ã€å‡½æ•°æˆ–å±æ€§è¿‡å¤šã€‚å½±å“ä»£ç çš„å¯è¯»æ€§å¯ç»´æŠ¤æ€§ã€‚</li>
<li>ç±»ä¾èµ–çš„å…¶ä»–ç±»è¿‡å¤šï¼Œæˆ–è€…ä¾èµ–è¿™ä¸ªç±»çš„å…¶ä»–ç±»è¿‡å¤šï¼Œä¸ç¬¦åˆé«˜å†…èšã€ä½è€¦åˆçš„è®¾è®¡æ€æƒ³ã€‚</li>
<li>æ‰€æœ‰æ–¹æ³•è¿‡å¤šçš„ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æ˜¯å¦å¯ä»¥å°†ç§æœ‰æ–¹æ³•ç‹¬ç«‹åˆ°æ–°ç±»ä¸­è®¾ç½®ä¸ºå…¬æœ‰æ–¹æ³•ï¼Œä»¥ä¾›æ›´å¤šç±»ä½¿ç”¨æé«˜ä»£ç å¤ç”¨ã€‚</li>
<li>æ¯”è¾ƒéš¾èµ·åå­—ã€‚è¿™æ—¶å€™è¯´æ˜ç±»çš„èŒè´£ä¸æ˜¯ååˆ†æ¸…æ™°ã€‚</li>
<li>å¤§é‡çš„æ–¹æ³•éƒ½é›†ä¸­æ“ä½œæŸå‡ ä¸ªå±æ€§ï¼Œæ¯”å¦‚åœ¨UserInfoä¸­ä¸€åŠçš„æ–¹æ³•åœ¨æ“ä½œaddressä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘å°†addressç›¸å…³çš„ä¿¡æ¯å’Œæ–¹æ³•æ‹†åˆ†å‡ºæ¥ã€‚</li>
</ol>
</li>
<li>æ²¡æœ‰å¾ˆå…·ä½“çš„æ–¹æ³•è®ºå’Œå¾ˆå®šé‡è¯´å¤šå°‘å±æ€§ç®—å¤šã€‚å¦‚æœè¦æ‰¾ä¸€ä¸ªæ ‡å‡†ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªç±»æ˜¯å¦å·²ç»è®©ä½ æ„Ÿè§‰ååˆ†å¤æ‚å’Œè¿‡å¤šåŠŸèƒ½äº†æ¥åˆ¤æ–­ã€‚</li>
</ol>
<h3 id="ç±»çš„èŒè´£æ˜¯å¦è¶Šå•ä¸€è¶Šå¥½">ç±»çš„èŒè´£æ˜¯å¦è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ</h3>
<p>çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-java">/**
 * Protocol format: identifier-string;{gson string}
 * For example: UEUEUE;{&quot;a&quot;:&quot;A&quot;,&quot;b&quot;:&quot;B&quot;}
 */
public class Serialization {
  private static final String IDENTIFIER_STRING = &quot;UEUEUE;&quot;;
  private Gson gson;
  
  public Serialization() {
    this.gson = new Gson();
  }
  
  public String serialize(Map&lt;String, String&gt; object) {
    StringBuilder textBuilder = new StringBuilder();
    textBuilder.append(IDENTIFIER_STRING);
    textBuilder.append(gson.toJson(object));
    return textBuilder.toString();
  }
  
  public Map&lt;String, String&gt; deserialize(String text) {
    if (!text.startsWith(IDENTIFIER_STRING)) {
        return Collections.emptyMap();
    }
    String gsonStr = text.substring(IDENTIFIER_STRING.length());
    return gson.fromJson(gsonStr, Map.class);
  }
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æƒ³æ‹†åˆ†è¿™ä¸ªç±»ï¼Œè®©èŒè´£æ›´å•ä¸€ï¼Œæ‹†åˆ†å‡ºSerializerå’ŒDeserializer</p>
<pre><code class="language-java">public class Serializer {
  private static final String IDENTIFIER_STRING = &quot;UEUEUE;&quot;;
  private Gson gson;
  
  public Serializer() {
    this.gson = new Gson();
  }
  
  public String serialize(Map&lt;String, String&gt; object) {
    StringBuilder textBuilder = new StringBuilder();
    textBuilder.append(IDENTIFIER_STRING);
    textBuilder.append(gson.toJson(object));
    return textBuilder.toString();
  }
}

public class Deserializer {
  private static final String IDENTIFIER_STRING = &quot;UEUEUE;&quot;;
  private Gson gson;
  
  public Deserializer() {
    this.gson = new Gson();
  }
  
  public Map&lt;String, String&gt; deserialize(String text) {
    if (!text.startsWith(IDENTIFIER_STRING)) {
        return Collections.emptyMap();
    }
    String gsonStr = text.substring(IDENTIFIER_STRING.length());
    return gson.fromJson(gsonStr, Map.class);
  }
}
</code></pre>
<p>æ‹†åˆ†ååŠŸèƒ½æ›´å•ä¸€äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœä¿®æ”¹äº†åè®®çš„æ ¼å¼ï¼Œæ•°æ®æ ‡è¯†ä»â€œUEUEUEâ€æ”¹ä¸ºâ€œDFDFDFâ€ï¼Œæˆ–è€…åºåˆ—åŒ–æ–¹å¼ä» JSON æ”¹ä¸ºäº† XMLï¼Œé‚£ Serializer ç±»å’Œ Deserializer ç±»éƒ½éœ€è¦åšç›¸åº”çš„ä¿®æ”¹ï¼Œä»£ç çš„å†…èšæ€§æ˜¾ç„¶æ²¡æœ‰åŸæ¥ Serialization é«˜äº†</p>
<p>æˆ–è€…æˆ‘ä»¬åªæ”¹äº†desirializerã€‚å¿˜è®°äº†serializerï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åºåˆ—åŒ–ååºåˆ—åŒ–ä¸åŒ¹é…ã€‚è¿™å…¶å®æ˜¯å¯ç»´æŠ¤æ€§å˜å·®äº†ã€‚</p>
<p><strong>æ€»ä½“è¿˜æ˜¯è¦ä»ä»£ç çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§å»è€ƒè™‘ã€‚</strong></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[74. Search a 2D Matrix]]></title>
        <id>https://10kshuaizhang.github.io/post/74-search-a-2d-matrix/</id>
        <link href="https://10kshuaizhang.github.io/post/74-search-a-2d-matrix/">
        </link>
        <updated>2023-06-14T23:20:14.000Z</updated>
        <content type="html"><![CDATA[<h2 id="question">Question</h2>
<p>You are given an <code>m x n</code> integer matrix <code>matrix</code> with the following two properties:</p>
<ul>
<li>Each row is sorted in non-decreasing order.</li>
<li>The first integer of each row is greater than the last integer of the previous row.</li>
</ul>
<p>Given an integer <code>target</code>, return <code>true</code> <em>if</em> <code>target</code> <em>is in</em> <code>matrix</code> <em>or</em> <code>false</code> <em>otherwise</em>.</p>
<p>You must write a solution in <code>O(log(m * n))</code> time complexity.</p>
<p><strong>Constraints:</strong></p>
<ul>
<li><code>m == matrix.length</code></li>
<li><code>n == matrix[i].length</code></li>
<li><code>1 &lt;= m, n &lt;= 100</code></li>
<li><code>-10^4 &lt;= matrix[i][j], target &lt;= 10^4</code></li>
</ul>
<h2 id="algorithm">Algorithm</h2>
<p>This is a typical binary search question. You have a strictly sorted array and you are asked to find the target. Now the array is segmented on a matrix, so you need to figure out how to map the 1D array index into a 2D array.</p>
<p>So basically, say we have a index <code>mid</code> in 1-D array, in the question, the matrix is</p>
<ul>
<li>Each row is sorted in non-decreasing order.</li>
<li>The first integer of each row is greater than the last integer of the previous row.</li>
</ul>
<p>So we could simply make</p>
<pre><code>i = mid / n;
j = mid % n;
</code></pre>
<p>Like this:</p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306150720359.png" alt="image-20230615071939948" loading="lazy"></figure>
<h2 id="code">Code</h2>
<pre><code class="language-java">class Solution {
    public boolean searchMatrix(int[][] matrix, int target) {
        int m = matrix.length;
        int n = matrix[0].length;
        int left = 0;
        int right = m * n;
        int mid, i, j;
        while (left &lt; right) {
            mid = left + (right - left) / 2;
            i = mid / n;
            j = mid % n;
            if (target == matrix[i][j]) {
                return true;
            } else if (target &gt; matrix[i][j]) {
                left = mid + 1;
            } else {
                right = mid;
            }
        }
        return false;
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[378. Kth Smallest Element in a Sorted Matrix]]></title>
        <id>https://10kshuaizhang.github.io/post/378-kth-smallest-element-in-a-sorted-matrix/</id>
        <link href="https://10kshuaizhang.github.io/post/378-kth-smallest-element-in-a-sorted-matrix/">
        </link>
        <updated>2023-06-13T23:34:01.000Z</updated>
        <content type="html"><![CDATA[<h2 id="question">Question</h2>
<p>Given an <code>n x n</code> <code>matrix</code> where each of the rows and columns is sorted in ascending order, return <em>the</em> <code>kth</code> <em>smallest element in the matrix</em>.</p>
<p>Note that it is the <code>kth</code> smallest element <strong>in the sorted order</strong>, not the <code>kth</code> <strong>distinct</strong> element.</p>
<p>You must find a solution with a memory complexity better than <code>O(n2)</code>.</p>
<p><strong>Example 1:</strong></p>
<pre><code>Input: matrix = [[1,5,9],[10,11,13],[12,13,15]], k = 8
Output: 13
Explanation: The elements in the matrix are [1,5,9,10,11,12,13,13,15], and the 8th smallest number is 13
</code></pre>
<h2 id="algorithm">Algorithm</h2>
<p>See the below each explanation.</p>
<h2 id="code">Code</h2>
<h3 id="code1">Code1</h3>
<p>I use a priority queue to store all the numbers and pop them according to the index.</p>
<pre><code class="language-java">class Solution {
    public int kthSmallest(int[][] matrix, int k) {
        // 1. pq nlogn time, n space, not utilizing the sorted order in x and y;
        PriorityQueue&lt;Integer&gt; pq = new PriorityQueue();
        for (int i = 0; i &lt; matrix.length; i++) {
            for (int j = 0; j &lt; matrix[0].length; j++) {
                pq.offer(matrix[i][j]);
            }
        }
        
        while (k-- &gt; 1) {
            pq.poll();
        }
        return pq.poll();
        
    }
}
</code></pre>
<h3 id="code2">Code2</h3>
<p>In my submission history and the answer provided by the leetcode, when they are using the priority queue, they also put the index info into the queue. I'm not fully understand this.</p>
<pre><code class="language-java">class Solution {
    public int kthSmallest(int[][] matrix, int k) {
        //solution 1 qriorityqueue 
        // space : O(n) time O(nlogn)
        PriorityQueue&lt;Tuple&gt; pq = new PriorityQueue&lt;&gt;(matrix.length, (a, b) -&gt; (a.val - b.val));
        for(int i = 0; i &lt; matrix.length; i++) {
            pq.offer(new Tuple(0, i, matrix[0][i]));
        }
        for(int i = 0; i &lt; k - 1; i++) {
            Tuple tuple = pq.poll();
            if(tuple.x == matrix.length - 1) continue;
            pq.offer(new Tuple(tuple.x + 1, tuple.y, matrix[tuple.x + 1][tuple.y]));
        }
        return pq.poll().val;
    }
    public class Tuple{
        int x, y, val;
        public Tuple(int x, int y, int val) {
            this.x = x;
            this.y = y;
            this.val = val;
        }
    }
}
</code></pre>
<h3 id="code3">Code3</h3>
<p>I also notice that each row is sorted, though I have no idea how to use binary search to tackle the problem.  Thanks to the <a href="https://anj910.medium.com/leetcode-378-kth-smallest-element-in-a-sorted-matrix-%E4%B8%AD%E6%96%87-318d52f366af">blog</a>, who gives a clear walk through of the binary search process.</p>
<p>If you go through this algorithm roughly, you will have a question: Overall the number is not sorted, how do they determine the mid number?</p>
<p>Actually this algorithm doesn't really use the real number, it use the number count. Let walk through it.</p>
<ol>
<li>
<p>We know the <code>matrix[0][0]</code> is the smallest number since in its right side and downside, all the numbers are larger, and thus <code>matrix[n-1][n-1]</code> is the largest in the matrix. So we are going to find the k-th largest number between them.</p>
</li>
<li>
<p>Each loop we will get the mid number and find its rank in the matrix. If this rank is smaller than k, we know that the number is smaller than the k-th number, we shrink the range to <code>[start, mid]</code>; if the mid number rank is larger than k, which means the mid number is larger than the k-th number and we need to go to <code>[mid+1, end]</code> to find the number.</p>
<ol>
<li>
<p>We use mid number, but the number may not be in the matrix. <strong>What we are looking for is the number count that is smaller/larger than that mid</strong>, and shrink the search range until we only have 1 number in the range.</p>
</li>
<li>
<p>Let's go through an example, find the 21th smallest number.</p>
 <img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080840934.png" alt="image-20230608084005803"  />
<ol>
<li>We search range<code>[1, 1000]</code>, mid number is 500, and we got 24 numbers smaller than 500, and the 21th we are looking for is smaller than 24, so we should shrink the search range in the first half, <code>[1, 500]</code>;</li>
<li>Then we look for range <code>[1, 500]</code>, calculate mid number 250, and there are 24 number smaller than 250, which means 250 is the 24th smallest number; thus the range shrink to the <code>[1, 125]</code>;</li>
<li>Then we look for range <code>[1, 125]</code>, calculate mid number 63, and there are 23 number smaller than 125, which means 125 is the 23rd smallest number; thus the range shrink to the <code>[1, 63]</code>;</li>
<li>Then we look for range <code>[1, 63]</code>, calculate mid number 33, and there are 16 number smaller than 63, which means 63 is the 16th smallest number, which means our search range should become <code>[33, 63]</code>;</li>
<li>Then we look for range <code>[33, 63]</code>, calculate mid number 48, and there are 22 number smaller than 48, which means 48 is the 22nd smallest number, which means our search range should become <code>[33, 48]</code>;</li>
<li>Then we look for range <code>[33, 48]</code>, calculate mid number 40, and there are 21 number smaller than 40, which means 40 is the 21st smallest number, target rank! But we cannot confirm that 40 is in the matrix. So we continue narrow down the range to <code>[33, 40]</code>;</li>
<li>Then we check range <code>[33, 40]</code>, mid number is 36 and it's rank is 18 so we know too much;</li>
<li>Then we check range <code>[37, 40]</code>, mid number is 38 and it's rank is 18 so we know too much;</li>
<li>Then we check range <code>[39, 40]</code>, mid number is 38 and it's rank is 19 so we know too much;</li>
<li>Then we get range <code>[40, 40]</code>, return it.</li>
</ol>
</li>
</ol>
</li>
<li>
<p>Now it becomes how do we count the number that are smaller than the mid number?</p>
<ol>
<li>
<p>Maybe leetcode 240 is a good start for this question to search target number in a 2D-matrix.</p>
</li>
<li>
<p>We start from left down corner and count how many numbers are smaller.</p>
</li>
<li>
<p>Lets walk through an example: <u>find how many numbers are smaller than 20</u></p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080855470.png" alt="image-20230608085555402" loading="lazy"></figure>
<ol>
<li>
<p>We use <code>count</code> to store the number;</p>
</li>
<li>
<p>We are starting from <code>matrix[4][0]</code> which is 19 and is smaller than 20, we know the numbers above it are larger, so the <code>count += 5</code>, which is 5 now. And to get closer to 20, we move the position rightward;</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080900048.png" alt="image-20230608090033996" loading="lazy"></figure>
</li>
<li>
<p>Now we have <code>matrix[4][1] &gt; 20</code>, so we go upwards for a smaller one; count = 5;</p>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080902555.png" alt="image-20230608090239506" loading="lazy"></figure>
</li>
<li>
<p>Now we have <code>matrix[3][1] &gt; 20</code>, so we go upwards for a smaller one; count = 5;</p>
<figure data-type="image" tabindex="4"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080903093.png" alt="image-20230608090316059" loading="lazy"></figure>
</li>
<li>
<p>Now we have <code>matrix[2][1] &gt; 20</code>, so we go upwards for a smaller one;count = 5;</p>
<figure data-type="image" tabindex="5"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080903982.png" alt="image-20230608090355929" loading="lazy"></figure>
</li>
<li>
<p>Now we have <code>matrix[1][1] &lt;= 20</code>, the number above it and in the left side are smaller than it, we came from right(larger side), so we go to right side to find a larger one(the final destination is the right above area); <code>count += 2</code>; count = 7;</p>
<figure data-type="image" tabindex="6"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080906099.png" alt="image-20230608090612039" loading="lazy"></figure>
</li>
<li>
<p>Now we have <code>matrix[1][2] &gt; 20</code>, so we go upwards for a smaller one; count = 7;</p>
<figure data-type="image" tabindex="7"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080907923.png" alt="image-20230608090710868" loading="lazy"></figure>
</li>
<li>
<p>Now we have <code>matrix[0][2] &lt;= 20</code>, the number above it and in the left side are smaller than it, we came from right(larger side), so we go to right side to check if there is a larger one(the final destination is the right above area); <code>count += 1</code>; count = 8;</p>
<figure data-type="image" tabindex="8"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080909183.png" alt="image-20230608090953136" loading="lazy"></figure>
</li>
<li>
<p>Now we are at <code>matrix[0][3]&lt;=20</code>. So we need to check if there are larger number in the right above area; so we go right; <code>count += 1</code>; count = 9;</p>
<figure data-type="image" tabindex="9"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080912774.png" alt="image-20230608091229689" loading="lazy"></figure>
</li>
<li>
<p>Now we are at <code>matrix[0][4] &gt; 20</code>. And we how nowhere to go (we are from left, and downside is even larger ones). count = 9.</p>
<figure data-type="image" tabindex="10"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080914357.png" alt="image-20230608091403309" loading="lazy"></figure>
</li>
<li>
<p>Thus, all the smaller number are found, count = 9; red marked all the grids we counted.</p>
<figure data-type="image" tabindex="11"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080928288.png" alt="image-20230608092835223" loading="lazy"></figure>
</li>
<li>
<p>The reason of each direction choose is that, for number 28, it's right upper area and left downside area are not guaranteed to be larger or smaller than it. So our count helper would go thought these areas to ensure we get all the qualified numbers.</p>
<figure data-type="image" tabindex="12"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306080938116.png" alt="image-20230608093829028" loading="lazy"></figure>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<pre><code class="language-java">class Solution {
    public int kthSmallest(int[][] matrix, int k) {
        int start = matrix[0][0];
        int end = matrix[matrix.length-1][matrix[0].length-1]+1;
        while(start&lt;end) {
            int mid = start+(end-start)/2;
            int count = 0;
            int j = matrix[0].length-1;
            for(int i = 0;i&lt;matrix.length;i++) {
                while(j&gt;=0 &amp;&amp; matrix[i][j] &gt; mid) j--;
                count += (j+1);
            }
            
            if(count &gt;= k) {
                end = mid;
            } else {
                start = mid+1;
            }
        }
        return start;
    }
}
</code></pre>
<p>Time complexity is O(n*log(max-min)).</p>
<h2 id="code4my-code">Code4(My code)</h2>
<pre><code class="language-java">class Solution {
    public int kthSmallest(int[][] matrix, int k) {
        int n = matrix.length;
        int left = matrix[0][0];
        int right = matrix[n-1][n-1];
        while (left &lt; right) {
            int mid = left + (right - left) / 2;
            int count = helper(matrix, mid);
            if (count &gt;= k) {
                right = mid;
            } else {
                left = mid + 1;
            }
        }
        return left;
    }
    private int helper(int[][] matrix, int num) {
        int n = matrix.length;
        int count = 0;
        int i = n - 1;
        int j = 0;
        while (i &gt;= 0 &amp;&amp; j &lt; n) {
            if (matrix[i][j] &lt;= num) {
                count += (i+1);
                j++;
            } else {
                i--;
            }
        }
        return count;
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[329. Longest Increasing Path in a Matrix]]></title>
        <id>https://10kshuaizhang.github.io/post/329-longest-increasing-path-in-a-matrix/</id>
        <link href="https://10kshuaizhang.github.io/post/329-longest-increasing-path-in-a-matrix/">
        </link>
        <updated>2023-06-06T23:31:01.000Z</updated>
        <content type="html"><![CDATA[<h3 id="question">Question</h3>
<p>Given an <code>m x n</code> integers <code>matrix</code>, return <em>the length of the longest increasing path in</em> <code>matrix</code>.</p>
<p>From each cell, you can either move in four directions: left, right, up, or down. You <strong>may not</strong> move <strong>diagonally</strong> or move <strong>outside the boundary</strong> (i.e., wrap-around is not allowed).</p>
<p><strong>Example 1:</strong></p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306060754252.jpg" alt="img" loading="lazy"></figure>
<pre><code>Input: matrix = [[9,9,4],[6,6,8],[2,1,1]]
Output: 4
Explanation: The longest increasing path is [1, 2, 6, 9].
</code></pre>
<p><strong>Example 2:</strong></p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/10kshuaizhang/note-images/main/202306060754171.jpg" alt="img" loading="lazy"></figure>
<pre><code>Input: matrix = [[3,4,5],[3,2,6],[2,2,1]]
Output: 4
Explanation: The longest increasing path is [3, 4, 5, 6]. Moving diagonally is not allowed.
</code></pre>
<p><strong>Example 3:</strong></p>
<pre><code>Input: matrix = [[1]]
Output: 1
</code></pre>
<p><strong>Constraints:</strong></p>
<ul>
<li><code>m == matrix.length</code></li>
<li><code>n == matrix[i].length</code></li>
<li><code>1 &lt;= m, n &lt;= 200</code></li>
<li><code>0 &lt;= matrix[i][j] &lt;= 231 - 1</code></li>
</ul>
<h2 id="algorithm">Algorithm</h2>
<ol>
<li>
<p>Naive flood filled algorithm will case a time limit exceed. Code1</p>
</li>
<li>
<p>If you think about the first solution, you may find when you traveling the matrix, some grid may be traversed repeatedly. So you may want utilize memorization to prune the unnecessary operations.</p>
<p>In the code2, I made a huge optimized both in code and algorithm. In Algorithm, the code 1 worst case is <u>O(2^m * 2^n),</u> and space is O(mn), while the code2 is O(mn) for both time and space. Because in the second algorithm, each grid will be touched once and only once due to the memo. In the code1, each grid will be travelled to the end if it's worst case.</p>
<p>In code, I use the direction array to avoid repetition in the code1. And the made the DFS itself return the desired value instead of introduce a new value carried with the function.</p>
<p>The implementation would be we go through each node, and then check if their neighbors has a recalculated result, if yes, we simply get that one and add one step(or level); if not, we do a DFS to its neighbor. In the DFS, we keep updating the memo to get the result for each grid. If you are going next level, we add the result one step.</p>
</li>
<li>
<p>There is another solution which utilize the dynamic programming. But before you dive into DP, since the grid has dependencies on its neighbors, so the elements you manipulate in DB should be sorted  first.</p>
<p>Such dependency sorting is topological sort.</p>
<p>Personally I think this is not that hard to implement but the more algorithm you involve in a solution, the higher chance you will get an error. So if you goal is to solve it, just use the algorithm2. That's enough.</p>
</li>
</ol>
<h2 id="code1naive-dfstle">Code1(Naive DFS)(TLE)</h2>
<pre><code class="language-java">class Solution {
    int res;
    public int longestIncreasingPath(int[][] matrix) {
        res = 1;
        for (int i = 0; i &lt; matrix.length; i++) {
            for (int j = 0; j &lt; matrix[0].length; j++) {
                dfs(matrix, i, j, 1);
            }
        }
        return res;
    }
    
    private void dfs(int[][] matrix, int i, int j, int level) {
        if (i - 1 &gt;= 0) {
            if (matrix[i-1][j] &gt; matrix[i][j]) {
                dfs(matrix, i - 1, j, level + 1);
            }
        }
        if (i + 1 &lt; matrix.length) {
            if (matrix[i+1][j] &gt; matrix[i][j]) {
                dfs(matrix, i + 1, j, level + 1);
            }
        }
        if (j - 1 &gt;= 0) {
            if (matrix[i][j-1] &gt; matrix[i][j]) {
                dfs(matrix, i, j - 1, level + 1);
            }
        }
        if (j + 1 &lt; matrix[0].length) {
            if (matrix[i][j+1] &gt; matrix[i][j]) {
                dfs(matrix, i, j + 1, level + 1);
            }
        }
        
        res = Math.max(res, level);
    }
}
</code></pre>
<h2 id="code2">Code2</h2>
<pre><code class="language-java">class Solution {
    int[][] memo;
    int m, n;
    private static final int[][] dirs = {{0, 1}, {0, -1}, {1, 0}, {-1, 0}};
    public int longestIncreasingPath(int[][] matrix) {
        int res = 1;
        m = matrix.length;
        n = matrix[0].length;
        memo = new int[m][n];
        
        for (int i = 0; i &lt; m; i++) {
            for (int j = 0; j &lt; n; j++) {
                res = Math.max(res, dfs(matrix, memo, i, j));
            }
        }
        return res;
    }
    
    private int dfs(int[][] matrix, int[][] memo, int i, int j) {
        if (memo[i][j] != 0) {
            return memo[i][j];
        }
        for (int[] dir : dirs) {
            int x = i + dir[0], y = j + dir[1];
            if (x &gt;= 0 &amp;&amp; x &lt; m &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; n &amp;&amp; matrix[x][y] &gt; matrix[i][j]) {
                memo[i][j] = Math.max(memo[i][j], dfs(matrix, memo, x, y));
            }
        }
        return ++memo[i][j];
        
    }
}
</code></pre>
]]></content>
    </entry>
</feed>