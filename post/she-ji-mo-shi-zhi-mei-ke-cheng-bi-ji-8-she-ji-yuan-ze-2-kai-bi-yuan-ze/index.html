<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°8-è®¾è®¡åŸåˆ™2-å¼€é—­åŸåˆ™(OCP) | 10K&#39;s</title>
<link rel="shortcut icon" href="https://10kshuaizhang.github.io/favicon.ico?v=1687157630552">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://10kshuaizhang.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°8-è®¾è®¡åŸåˆ™2-å¼€é—­åŸåˆ™(OCP) | 10K&#39;s - Atom Feed" href="https://10kshuaizhang.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=G-L6PETZ11Z8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L6PETZ11Z8');
</script>


    <meta name="description" content="ç†è®ºäºŒï¼šå¦‚ä½•åšåˆ°â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿæ‰©å±•å’Œä¿®æ”¹å„æŒ‡ä»€ä¹ˆï¼Ÿ
å¼€é—­åŸåˆ™æ¯”è¾ƒéš¾ç†è§£ï¼Œå› ä¸ºå…³äºæ‰©å±•ã€ä¿®æ”¹çš„å®šä¹‰æ¯”è¾ƒéš¾å®šä¹‰ã€‚ä»€ä¹ˆæ ·ç®—éµå®ˆï¼Œä»€ä¹ˆæ ·ç®—è¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚
è¿™æ¡åŸåˆ™æ˜¯å…³äºæ‰©å±•æ€§ï¼Œè€Œæ‰©å±•æ€§æ˜¯è¡¡é‡ä»£ç è´¨é‡å¾ˆé‡è¦çš„æ ‡å‡†ã€‚23ç§ç»å…¸è®¾è®¡æ¨¡å¼ä¸­ï¼Œ..." />
    <meta name="keywords" content="OOD,Design Pattern" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://10kshuaizhang.github.io">
  <img class="avatar" src="https://10kshuaizhang.github.io/images/avatar.png?v=1687157630552" alt="">
  </a>
  <h1 class="site-title">
    10K&#39;s
  </h1>
  <p class="site-description">
    Shortcuts are the farthest path, so you must write and think honestly, which is the basic requirement for progress.
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          Home
        </a>
      
    
      
        <a href="/archives" class="menu">
          Archive
        </a>
      
    
      
        <a href="/post/about" class="menu">
          About
        </a>
      
    
      
        <a href="/tags" class="menu">
          Tags
        </a>
      
    
      
        <a href="/post/books" class="menu">
          Books
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/10kshuaizhang" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
        <a href="https://twitter.com/jason278642682" target="_blank">
          <i class="ri-twitter-line"></i>
        </a>
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°8-è®¾è®¡åŸåˆ™2-å¼€é—­åŸåˆ™(OCP)
            </h2>
            <div class="post-info">
              <span>
                2023-06-18
              </span>
              <span>
                13 min read
              </span>
              
                <a href="https://10kshuaizhang.github.io/tag/sSLhqMzY-/" class="post-tag">
                  # OOD
                </a>
              
                <a href="https://10kshuaizhang.github.io/tag/d2JaGqwpzA/" class="post-tag">
                  # Design Pattern
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <h2 id="ç†è®ºäºŒå¦‚ä½•åšåˆ°å¯¹æ‰©å±•å¼€æ”¾-ä¿®æ”¹å…³é—­æ‰©å±•å’Œä¿®æ”¹å„æŒ‡ä»€ä¹ˆ">ç†è®ºäºŒï¼šå¦‚ä½•åšåˆ°â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿæ‰©å±•å’Œä¿®æ”¹å„æŒ‡ä»€ä¹ˆï¼Ÿ</h2>
<p>å¼€é—­åŸåˆ™æ¯”è¾ƒéš¾ç†è§£ï¼Œå› ä¸ºå…³äºæ‰©å±•ã€ä¿®æ”¹çš„å®šä¹‰æ¯”è¾ƒéš¾å®šä¹‰ã€‚ä»€ä¹ˆæ ·ç®—éµå®ˆï¼Œä»€ä¹ˆæ ·ç®—è¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</p>
<p>è¿™æ¡åŸåˆ™æ˜¯å…³äºæ‰©å±•æ€§ï¼Œè€Œæ‰©å±•æ€§æ˜¯è¡¡é‡ä»£ç è´¨é‡å¾ˆé‡è¦çš„æ ‡å‡†ã€‚23ç§ç»å…¸è®¾è®¡æ¨¡å¼ä¸­ï¼Œå¤§éƒ¨åˆ†è®¾è®¡æ¨¡å¼éƒ½æ˜¯ä¸ºäº†è§£å†³ä»£ç çš„æ‰©å±•æ€§é—®é¢˜å­˜åœ¨çš„ã€‚</p>
<h3 id="å¦‚ä½•ç†è§£å¯¹æ‰©å±•å¼€æ”¾-ä¿®æ”¹å…³é—­">å¦‚ä½•ç†è§£â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿ</h3>
<ol>
<li>
<p>å¼€é—­åŸåˆ™çš„è‹±æ–‡å…¨ç§°æ˜¯Open Closed Principleï¼ŒOCPã€‚ä»–çš„è‹±æ–‡æè¿°æ˜¯software entities(modules, classes, functions, etc.) should be open for extension, but closed for modification. è½¯ä»¶å®ä½“ï¼ˆæ¨¡å—ã€ç±»ã€æ–¹æ³•ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p>
<ol>
<li>è¯´å¾—æ˜ç™½ç‚¹å°±æ˜¯ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½åº”è¯¥æ˜¯åœ¨å·²æœ‰ä»£ç çš„åŸºç¡€ä¸Šæ‰©å±•ä»£ç ï¼ˆæ–°å¢æ¨¡å—ã€ç±»ã€æ–¹æ³•ï¼‰ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç ï¼ˆä¿®æ”¹æ¨¡å—ã€ç±»ã€æ–¹æ³•ï¼‰ã€‚</li>
</ol>
</li>
<li>
<p>ä¸¾ä¸ªä¾‹å­ğŸŒ°</p>
<ol>
<li>
<p>ä½œè€…ç»™äº†ä¸€æ®µAPIæ¥å£ç›‘æ§å‘Šè­¦çš„ä»£ç ã€‚å…¶ä¸­AlterRuleå­˜å‚¨è­¦å‘Šè§„åˆ™ï¼Œå¯ä»¥è‡ªç”±è®¾ç½®ã€‚Notification æ˜¯å‘Šè­¦é€šçŸ¥ç±»ï¼Œæ”¯æŒé‚®ä»¶ã€çŸ­ä¿¡ã€å¾®ä¿¡ã€æ‰‹æœºç­‰å¤šç§é€šçŸ¥æ¸ é“ã€‚NotificationEmergencyLevel è¡¨ç¤ºé€šçŸ¥çš„ç´§æ€¥ç¨‹åº¦ï¼ŒåŒ…æ‹¬ SEVEREï¼ˆä¸¥é‡ï¼‰ã€URGENCYï¼ˆç´§æ€¥ï¼‰ã€NORMALï¼ˆæ™®é€šï¼‰ã€TRIVIALï¼ˆæ— å…³ç´§è¦ï¼‰ï¼Œä¸åŒçš„ç´§æ€¥ç¨‹åº¦å¯¹åº”ä¸åŒçš„å‘é€æ¸ é“ã€‚</p>
<pre><code class="language-java">public class Alert {
  private AlertRule rule;
  private Notification notification;

  public Alert(AlertRule rule, Notification notification) {
    this.rule = rule;
    this.notification = notification;
  }

  public void check(String api, long requestCount, long errorCount, long durationOfSeconds) {
    long tps = requestCount / durationOfSeconds;
    if (tps &gt; rule.getMatchedRule(api).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
    if (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);
    }
  }
}
</code></pre>
</li>
<li>
<p>ç°åœ¨æˆ‘ä»¬è¦å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œå½“æ¯ç§’é’Ÿæ¥å£<u>è¶…æ—¶è¯·æ±‚ä¸ªæ•°è¶…è¿‡æœ€å¤§é˜ˆå€¼</u>ï¼Œä¹Ÿè¦è§¦å‘æŠ¥è­¦ã€‚ä¿®æ”¹ç‚¹åœ¨äºï¼š</p>
<ol>
<li>checkçš„å…¥å‚è¦å¢åŠ è¶…æ—¶è¯·æ±‚ä¸ªæ•°ï¼›</li>
<li>checkä¸­æ–°å¢ç›¸åº”çš„åˆ¤æ–­é€»è¾‘ã€‚</li>
</ol>
<pre><code class="language-java">public class Alert {
  // ...çœç•¥AlertRule/Notificationå±æ€§å’Œæ„é€ å‡½æ•°...
  
  // æ”¹åŠ¨ä¸€ï¼šæ·»åŠ å‚æ•°timeoutCount
  public void check(String api, long requestCount, long errorCount, long timeoutCount, long durationOfSeconds) {
    long tps = requestCount / durationOfSeconds;
    if (tps &gt; rule.getMatchedRule(api).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
    if (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);
    }
    // æ”¹åŠ¨äºŒï¼šæ·»åŠ æ¥å£è¶…æ—¶å¤„ç†é€»è¾‘
    long timeoutTps = timeoutCount / durationOfSeconds;
    if (timeoutTps &gt; rule.getMatchedRule(api).getMaxTimeoutTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
  }
}
</code></pre>
</li>
<li>
<p>è¿™æ ·çš„è®¾è®¡å’Œä¿®æ”¹çš„é—®é¢˜åœ¨äº<u>æ‰€æœ‰ä½¿ç”¨åˆ°è¿™ä¸ªæ–¹æ³•çš„åœ°æ–¹éƒ½è¦ä¿®æ”¹ã€‚æ‰€æœ‰çš„å•æµ‹ä¹Ÿéœ€è¦ç›¸åº”çš„ä¿®æ”¹ã€‚</u></p>
</li>
<li>
<p>è¿™æ ·çš„æ”¹åŠ¨æ˜¯åŸºäºâ€œä¿®æ”¹â€æ¥å®ç°çš„ã€‚æˆ‘ä»¬å°†éµå¾ªå¼€é—­åŸåˆ™ï¼Œä»¥æ˜“æ‰©å±•çš„æ–¹å¼è®¾è®¡å’Œå®ç°ä¿®æ”¹ã€‚</p>
</li>
<li>
<p>é¦–å…ˆé‡æ„ä¸€ä¸‹ä¹‹å‰çš„Alertä»£ç </p>
<ol>
<li>å°†checkçš„å¤šä¸ªå…¥å‚ç­‰è£…æˆApiStateInfoç±»ï¼›</li>
<li>å¼•å…¥handlerçš„æ¦‚å¿µï¼Œå°†ifåˆ¤æ–­é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªhandlerä¸­ã€‚</li>
</ol>
<pre><code class="language-java">public class Alert {
  private List&lt;AlertHandler&gt; alertHandlers = new ArrayList&lt;&gt;();
  
  public void addAlertHandler(AlertHandler alertHandler) {
    this.alertHandlers.add(alertHandler);
  }

  public void check(ApiStatInfo apiStatInfo) {
    for (AlertHandler handler : alertHandlers) {
      handler.check(apiStatInfo);
    }
  }
}

public class ApiStatInfo {//çœç•¥constructor/getter/setteræ–¹æ³•
  private String api;
  private long requestCount;
  private long errorCount;
  private long durationOfSeconds;
}

public abstract class AlertHandler {
  protected AlertRule rule;
  protected Notification notification;
  public AlertHandler(AlertRule rule, Notification notification) {
    this.rule = rule;
    this.notification = notification;
  }
  public abstract void check(ApiStatInfo apiStatInfo);
}

public class TpsAlertHandler extends AlertHandler {
  public TpsAlertHandler(AlertRule rule, Notification notification) {
    super(rule, notification);
  }

  @Override
  public void check(ApiStatInfo apiStatInfo) {
    long tps = apiStatInfo.getRequestCount()/ apiStatInfo.getDurationOfSeconds();
    if (tps &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxTps()) {
      notification.notify(NotificationEmergencyLevel.URGENCY, &quot;...&quot;);
    }
  }
}

public class ErrorAlertHandler extends AlertHandler {
  public ErrorAlertHandler(AlertRule rule, Notification notification){
    super(rule, notification);
  }

  @Override
  public void check(ApiStatInfo apiStatInfo) {
    if (apiStatInfo.getErrorCount() &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxErrorCount()) {
      notification.notify(NotificationEmergencyLevel.SEVERE, &quot;...&quot;);
    }
  }
}
</code></pre>
</li>
<li>
<p>ä½¿ç”¨Alertã€‚ApplicationContext æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè´Ÿè´£ Alert çš„åˆ›å»ºã€ç»„è£…ï¼ˆalertRule å’Œ notification çš„ä¾èµ–æ³¨å…¥ï¼‰ã€åˆå§‹åŒ–ï¼ˆæ·»åŠ  handlersï¼‰å·¥ä½œã€‚å•ä¾‹ç›¸å½“äºç»™Alert featureçš„è°ƒç”¨æä¾›ä¸€ä¸ªæŠ“æ‰‹ã€å…¥å£ã€‚</p>
<pre><code class="language-java">public class ApplicationContext {
  private AlertRule alertRule;
  private Notification notification;
  private Alert alert;
  
  public void initializeBeans() {
    alertRule = new AlertRule(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    notification = new Notification(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    alert = new Alert();
    alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));
    alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));
  }
  public Alert getAlert() { return alert; }

  // é¥¿æ±‰å¼å•ä¾‹
  private static final ApplicationContext instance = new ApplicationContext();
  private ApplicationContext() {
    initializeBeans();
  }
  public static ApplicationContext getInstance() {
    return instance;
  }
}

public class Demo {
  public static void main(String[] args) {
    ApiStatInfo apiStatInfo = new ApiStatInfo();
    // ...çœç•¥è®¾ç½®apiStatInfoæ•°æ®å€¼çš„ä»£ç 
    ApplicationContext.getInstance().getAlert().check(apiStatInfo);
  }
}
</code></pre>
</li>
<li>
<p>å†è¿›è¡Œä¹‹å‰è¯´çš„æ”¹åŠ¨ï¼Œå¯¹äºæ¯ç§’é’Ÿæ¥å£è¶…æ—¶è¯·æ±‚ä¸ªæ•°è¶…è¿‡æŸä¸ªæœ€å¤§é˜ˆå€¼å°±å‘Šè­¦ã€‚</p>
<ol>
<li>ç»™ApiStatInfoç±»å¢åŠ ä¸€ä¸ªå±æ€§ï¼šè¶…æ—¶è¯·æ±‚ä¸ªæ•°timeOutCount;</li>
<li>å¢åŠ ä¸€ä¸ªhandlerï¼Œåœ¨è¿™ä¸ªhandlerä¸­çš„checkæ–¹æ³•å®ç°è¿™ä¸ªå‘Šè­¦è§„åˆ™ï¼›</li>
<li>å†initializebeanï¼ˆapplication context)çš„æ—¶å€™ç»™å•ä¾‹çš„alteræ·»åŠ ä¸Šè¿™ä¸ªhandlerã€‚</li>
<li>ä½¿ç”¨alterçš„æ—¶å€™ï¼Œç»™checkå‡½æ•°çš„å…¥å‚apiStatInfoå¯¹è±¡è®¾ç½®ç›¸åº”çš„timeOutCountå€¼ã€‚</li>
</ol>
<p>è¿™æ ·åŸºäºæ‰©å±•å¢åŠ äº†æ–°çš„handlerï¼Œä¸éœ€è¦æ”¹åŠ¨åŸæ¥çš„checké€»è¾‘ï¼Œä¹Ÿåªéœ€è¦ä¸ºæ–°çš„handlerå¢åŠ å•æµ‹ï¼Œä»¥å‰çš„ä¸ä¼šå¤±æ•ˆã€‚</p>
<pre><code class="language-java">public class Alert { // ä»£ç æœªæ”¹åŠ¨... }
public class ApiStatInfo {//çœç•¥constructor/getter/setteræ–¹æ³•
  private String api;
  private long requestCount;
  private long errorCount;
  private long durationOfSeconds;
  private long timeoutCount; // æ”¹åŠ¨ä¸€ï¼šæ·»åŠ æ–°å­—æ®µ
}
public abstract class AlertHandler { //ä»£ç æœªæ”¹åŠ¨... }
public class TpsAlertHandler extends AlertHandler {//ä»£ç æœªæ”¹åŠ¨...}
public class ErrorAlertHandler extends AlertHandler {//ä»£ç æœªæ”¹åŠ¨...}
// æ”¹åŠ¨äºŒï¼šæ·»åŠ æ–°çš„handler
public class TimeoutAlertHandler extends AlertHandler {//çœç•¥ä»£ç ...}

public class ApplicationContext {
  private AlertRule alertRule;
  private Notification notification;
  private Alert alert;
  
  public void initializeBeans() {
    alertRule = new AlertRule(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    notification = new Notification(/*.çœç•¥å‚æ•°.*/); //çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç 
    alert = new Alert();
    alert.addAlertHandler(new TpsAlertHandler(alertRule, notification));
    alert.addAlertHandler(new ErrorAlertHandler(alertRule, notification));
    // æ”¹åŠ¨ä¸‰ï¼šæ³¨å†Œhandler
    alert.addAlertHandler(new TimeoutAlertHandler(alertRule, notification));
  }
  //...çœç•¥å…¶ä»–æœªæ”¹åŠ¨ä»£ç ...
}

public class Demo {
  public static void main(String[] args) {
    ApiStatInfo apiStatInfo = new ApiStatInfo();
    // ...çœç•¥apiStatInfoçš„setå­—æ®µä»£ç 
    apiStatInfo.setTimeoutCount(289); // æ”¹åŠ¨å››ï¼šè®¾ç½®tiemoutCountå€¼
    ApplicationContext.getInstance().getAlert().check(apiStatInfo);
}
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="ä¿®æ”¹ä»£ç æ„å‘³ç€è¿åå¼€é—­åŸåˆ™å—">ä¿®æ”¹ä»£ç æ„å‘³ç€è¿åå¼€é—­åŸåˆ™å—</h3>
<p>ä¸Šè¿°ä¿®æ”¹çš„1/3/4ä¸éƒ½æ˜¯åœ¨ä¿®æ”¹äº†åŸæ¥çš„ä»£ç å—ï¼Ÿè®©æˆ‘ä»¬ä¸€ä¸ªä¸ªåˆ†æï¼š</p>
<ol>
<li>
<p>å¾€ApiStateInfoä¸­å¢åŠ æ–°çš„å±æ€§timeOutCount</p>
<ul>
<li>
<p>æˆ‘ä»¬ä¸ä»…å¢åŠ äº†æ–°çš„å±æ€§ï¼Œè¿˜å¢åŠ äº†getterã€Setterã€‚</p>
</li>
<li>
<p>åœ¨â€ç±»â€œçš„ç²’åº¦ä¸Šæˆ‘ä»¬æ˜¯åœ¨ä¿®æ”¹ç±»ï¼Œå¢åŠ äº†æ–°çš„å±æ€§ï¼›ä½†æ˜¯åœ¨â€æ–¹æ³•â€œçš„ç²’åº¦ä¸Šï¼Œæˆ‘ä»¬æ²¡æœ‰æ”¹å˜ç°æœ‰çš„å…¶ä»–æ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªå¢åŠ åˆå¯ä»¥æ˜¯æ‹“æ‰©å±•</p>
</li>
<li>
<p>æˆ‘ä»¬ä¸éœ€è¦çº ç»“ï¼ˆæˆ‘è®¤åŒï¼Œä¸éœ€è¦çº ç»“æ¦‚å¿µï¼‰ä»–æ˜¯ä¿®æ”¹è¿˜æ˜¯æ‰©å±•ã€‚å›åˆ°è¿™ä¸ªåŸåˆ™çš„è®¾è®¡åˆè¡·å°±æ˜¯**<u>æ²¡æœ‰ç ´ååŸæœ‰ä»£ç çš„è¿è¡Œï¼Œæ²¡æœ‰ç ´åå•æµ‹ã€‚</u>**</p>
</li>
</ul>
</li>
<li>
<p>æ”¹åŠ¨3ã€4ã€‚è™½ç„¶åœ¨å„ä¸ªå±‚é¢éƒ½æ˜¯ä¿®æ”¹ï¼Œä½†æ˜¯ä»–ä»¬æ˜¯ä¸å¯é¿å…çš„ï¼Œ<u>æ˜¯å¯ä»¥æ¥å—çš„ã€‚</u></p>
<ul>
<li>
<p>æˆ‘ä»¬è¦è®¤è¯†åˆ°ï¼Œæ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä¸å¯èƒ½ä»»ä½•æ¨¡å—ã€ç±»ã€æ–¹æ³•çš„ä»£ç éƒ½ä¸â€œä¿®æ”¹â€ï¼Œè¿™ä¸ªæ˜¯åšä¸åˆ°çš„ã€‚ç±»éœ€è¦åˆ›å»ºã€ç»„è£…ã€å¹¶ä¸”åšä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ‰èƒ½æ„å»ºæˆå¯è¿è¡Œçš„çš„ç¨‹åºï¼Œè¿™éƒ¨åˆ†ä»£ç çš„ä¿®æ”¹æ˜¯åœ¨æ‰€éš¾å…çš„ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯å°½é‡è®©ä¿®æ”¹æ“ä½œæ›´é›†ä¸­ã€æ›´å°‘ã€æ›´ä¸Šå±‚ï¼Œå°½é‡è®©æœ€æ ¸å¿ƒã€æœ€å¤æ‚çš„é‚£éƒ¨åˆ†é€»è¾‘ä»£ç æ»¡è¶³å¼€é—­åŸåˆ™ã€‚</p>
<blockquote>
<p>ç»†ææœ«èŠ‚å› ä¸ºjavaçš„è¯­æ³•å’Œä»£ç è®¾è®¡è‚¯å®šéœ€è¦å¢å¼ºå’Œä¿®æ”¹ï¼Œä½†æ˜¯åŸæ¥çš„æ ¸å¿ƒé€»è¾‘æ˜¯æ²¡æœ‰åŠ¨çš„ï¼Œå°±æ˜¯å¢åŠ äº†ä¸€ä¸ªhandlerå¤„ç†æ–°çš„é€»è¾‘ã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h3 id="å¦‚ä½•åšåˆ°å¯¹æ‰©å±•å¼€æ”¾-ä¿®æ”¹å…³é—­">å¦‚ä½•åšåˆ°â€å¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€œ</h3>
<ol>
<li>
<p>æˆ‘ä¸€å¼€å§‹ç¡®å®æƒ³ä¸åˆ°è®¾è®¡handlerã€‚ç¬”è€…ä¹Ÿè¯´äº†æ…¢æ…¢ç§¯ç´¯ç»éªŒã€‚</p>
</li>
<li>
<p><strong>æ—¶åˆ»å…·å¤‡æ‰©å±•æ„è¯†ï¼ŒæŠ½è±¡æ„è¯†ï¼Œå°è£…æ„è¯†</strong></p>
</li>
<li>
<p>åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œè¦èŠ±æ—¶é—´å¤šå¾€åæ€è€ƒè¿™æ®µä»£ç å¯èƒ½ä¼šæœ‰å“ªäº›éœ€æ±‚å˜æ›´ã€å¦‚ä½•è®¾è®¡ä»£ç ç»“æ„ï¼Œäº‹å…ˆç•™å¥½æ‰©å±•ç‚¹ï¼Œä»¥ä¾¿åœ¨æœªæ¥éœ€æ±‚å˜æ›´æ—¶å€™ä¸éœ€è¦æ”¹åŠ¨ä»£ç æ•´ä½“ç»“æ„ã€‚åšåˆ°æœ€å°ä»£ç è®¾è®¡æ”¹åŠ¨æƒ…å†µä¸‹ï¼Œæ–°ä»£ç å¾ˆçµæ´»çš„æ’å…¥åˆ°æ‰©å±•ç‚¹ã€‚</p>
</li>
<li>
<p>åœ¨è¯†åˆ«ä»£ç çš„å¯å˜éƒ¨åˆ†å’Œä¸å¯å˜éƒ¨åˆ†åï¼Œæˆ‘ä»¬è¦å°†å¯å˜éƒ¨åˆ†å°è£…èµ·æ¥ï¼Œéš”ç¦»å˜åŒ–ï¼Œæä¾›æŠ½è±¡åŒ–çš„ä¸å¯å˜æ¥å£ç»™ä¸Šå±‚ä½¿ç”¨ã€‚</p>
</li>
<li>
<p>åœ¨ä¼—å¤šè®¾è®¡åŸåˆ™ï¼Œæ€æƒ³ï¼Œæ¨¡å¼ä¸­ï¼Œæœ€å¸¸ç”¨æ¥æé«˜ä»£ç æ‰©å±•æ€§çš„æ–¹æ³•æœ‰ï¼šå¤šæ€ã€ä¾èµ–æ³¨å…¥ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä»¥åŠå¤§éƒ¨åˆ†è®¾è®¡æ¨¡å¼ï¼ˆåé¢è¯¦ç»†è¯´ï¼‰ã€‚</p>
<ol>
<li>
<p>å¤šæ€ã€ä¾èµ–æ³¨å…¥ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹éƒ½æ˜¯åŒä¸€ä¸ªå“²å­¦ï¼ˆæˆ–è€…è¯´æ€è·¯ï¼‰ï¼Œåªæ˜¯ä»ä¸åŒè§’åº¦é˜è¿°ã€‚</p>
</li>
<li>
<p>æ¥ä¸ªä¾‹å­ï¼šæˆ‘ä»¬é€šè¿‡Kafkaå‘é€å¼‚æ­¥æ¶ˆæ¯ã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªåŠŸèƒ½çš„å¼€å‘ä¸­æˆ‘ä»¬è¦å­¦ä¼šå°†å…¶æŠ½è±¡æˆä¸€ç»„è·Ÿå…·ä½“æ¶ˆæ¯é˜Ÿåˆ—æ— å…³çš„å¼‚æ­¥æ¶ˆæ¯æ¥å£ã€‚ä»¥ä¾¿æˆ‘ä»¬åœ¨ä»¥åç”¨RabbitMQæ›¿æ¢Kafkaçš„æ—¶å€™å¾ˆæ–¹ä¾¿ã€‚</p>
<pre><code class="language-java">// è¿™ä¸€éƒ¨åˆ†ä½“ç°äº†æŠ½è±¡æ„è¯†
public interface MessageQueue { //... }
public class KafkaMessageQueue implements MessageQueue { //... }
public class RocketMQMessageQueue implements MessageQueue {//...}

public interface MessageFromatter { //... }
public class JsonMessageFromatter implements MessageFromatter {//...}
public class ProtoBufMessageFromatter implements MessageFromatter {//...}

public class Demo {
  private MessageQueue msgQueue; // åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹
  public Demo(MessageQueue msgQueue) { // ä¾èµ–æ³¨å…¥
    this.msgQueue = msgQueue;
  }
  
  // msgFormatterï¼šå¤šæ€ã€ä¾èµ–æ³¨å…¥
  public void sendNotification(Notification notification, MessageFormatter msgFormatter) {
    //...    
  }
}
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨è¿™ä¸ªåŸåˆ™">å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨è¿™ä¸ªåŸåˆ™ï¼Ÿ</h3>
<ol>
<li><strong><u>å¦‚ä½•è¯†åˆ«æ‰©å±•ç‚¹</u></strong>ï¼š
<ol>
<li>å¦‚æœæ˜¯ä¸šåŠ¡å¯¼å‘çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦å°½å¯èƒ½äº†è§£ä¸šåŠ¡ï¼Œèƒ½å¤ŸçŸ¥é“å½“ä¸‹æœªæ¥å¯èƒ½éœ€è¦æ”¯æŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚</li>
<li>å¦‚æœæ˜¯è·Ÿä¸šåŠ¡æ— å…³çš„ååº•å±‚çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ¡†æ¶ç»„ä»¶ç±»åº“ç­‰ï¼Œä½ éœ€è¦äº†è§£ä»–ä»¬å¯èƒ½ä¼šå¦‚ä½•è¢«ä½¿ç”¨ï¼Œæ‰“ç®—æ·»åŠ ä»€ä¹ˆåŠŸèƒ½ï¼Œä½¿ç”¨è€…æœªæ¥å¯èƒ½ä¼šæœ‰ä»€ä¹ˆéœ€æ±‚ï¼Ÿ</li>
</ol>
</li>
<li>ä¸è¿‡è¿˜æ˜¯è¦é€‚åº¦ï¼Œé¿å…è¿‡åº¦è®¾è®¡ã€‚</li>
<li>æ‰€ä»¥å¯¹äºä¸€äº›æ¯”è¾ƒç¡®å®šçš„ã€çŸ­æœŸèƒ½å¯èƒ½æ‰©å±•ï¼Œæˆ–è€…éœ€æ±‚æ”¹åŠ¨å¯¹ä»£ç ç»“æ„å½±å“æ¯”è¾ƒå¤§çš„æƒ…å†µï¼Œæˆ–è€…æ˜¯å®ç°æˆæœ¬ä¸é«˜çš„æ‰©å±•ç‚¹ï¼Œåœ¨å†™ä»£ç çš„æ—¶å€™å¯ä»¥æ˜¯å…ˆåšæ‰©å±•æ€§è®¾è®¡ã€‚</li>
<li>ä½†æ˜¯å¯¹äºä¸ç¡®å®šæœªæ¥è¦æ”¯æŒçš„éœ€æ±‚ï¼Œæ‰©å±•æ¯”è¾ƒå¤æ‚çš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥ç­‰éœ€æ±‚é©±åŠ¨å†å»åšé€šè¿‡é‡æ„çš„æ–¹å¼æ¥æ”¯æŒæ‰©å±•ã€‚</li>
<li>æ‰©å±•å¯èƒ½ä¼šå’Œå¯è¯»æ€§å†²çªã€‚Alertä»£ç åœ¨è€ƒè™‘è¿‡æ‰©å±•æ€§ä¹‹åçš„é‡æ„è®¾è®¡å’Œç†è§£ä¸Šéƒ½å¢åŠ äº†ä¸€äº›éš¾åº¦ã€‚æˆ‘ä»¬éœ€è¦åšä¸€äº›æƒè¡¡ã€‚</li>
</ol>
<p>æˆ‘ä¹‹å‰å¯¹äºä¸€äº›å¥½ä»£ç çš„ç†è§£å•çº¯æ˜¯DRYï¼Œä¹Ÿå°±æ˜¯ä¸é‡å¤çš„ä»£ç ã€‚è¿™ä¸ªæ€è·¯æ²¡é”™ä½†æ˜¯ç°åœ¨çœ‹æ¥æœ‰ç‚¹åˆé˜¶æˆ–è€…æ˜¯æµ…æ˜¾äº†ã€‚ä¹‹å‰ä¸€ä¸ªéœ€æ±‚å°±æ˜¯å¯¹äºå¤šä¸ªObjectå¢åŠ ä¸€ä¸ªæ–°çš„unique idï¼Œç„¶åè¦å¯¹ä»–ä»¬çš„æ ¼å¼å’Œå”¯ä¸€æ€§åšæ ¡éªŒã€‚æœ€å¼€å§‹çš„è®¾è®¡å’Œå®ç°æ˜¯åœ¨æ¯ä¸ªObjectçš„managerçš„saveæ–¹æ³•ä¸­å»å®ç°äº†è¿™ä¸ªvalidatorï¼Œå…¶å®æ¯ä¸ªvalidatorçš„è§†çº¿é€»è¾‘å¤§æ¦‚æœ‰80%ç›¸ä¼¼ï¼Œä½†æ˜¯æ“ä½œçš„Objectä¸åŒï¼Œæ ¡éªŒé€»è¾‘å¤§æ¦‚æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚</p>
<p>åé¢å°±åœ¨ä¸€åˆ°ä¸¤å‘¨åæœ‰äº†ç‚¹æ—¶é—´ï¼Œåœ¨åšè¿™ä¸ªfunctionçš„testçš„æ—¶å€™åšäº†é‡æ„ï¼Œè¿™æ¬¡é‡æ„æ˜¯é’ˆå¯¹çš„é‡å¤ä»£ç ï¼ŒæŠŠè¿™äº›validationçš„é€»è¾‘ä»æ¯ä¸ªObjectçš„managerä¸­æŠ½ç¦»å‡ºæ¥ï¼Œåšäº†ä¸€ä¸ªvalidatorç±»ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªé™æ€çš„validationæ–¹æ³•ï¼Œé’ˆå¯¹ä¼ è¿›æ¥çš„å‚æ•°ç±»å‹ç¡®å®šä½¿ç”¨ä¸åŒçš„æ ¡éªŒç»†èŠ‚çš„å¢å‡ï¼Œè¿™æ ·ä¸€ä¸‹å­å°†ä»£ç é›†ä¸­ï¼Œå˜å¾—æ›´å¥½ç»´æŠ¤ï¼Œè€Œä¸”ä¹Ÿå‡å°‘äº†ä»£ç é‡ï¼Œæå‡äº†å¯è¯»æ€§ã€‚</p>
<p>ä½†å½“æ—¶reviewä»£ç çš„åŒäº‹å°±æå‡ºäº†ä¸€ä¸ªå»ºè®®å°±æ˜¯è¯´å¦‚æœè€ƒè™‘åˆ°æ•´ä¸ªä»£ç çš„å¯æ‰©å±•æ€§ï¼Œä»¥åå¦‚æœè¿˜è¦ç»™å…¶ä»–çš„objectå¢åŠ è¿™ä¸ªunique idä»¥åŠç±»ä¼¼çš„æ ¡éªŒé€»è¾‘ï¼Œè¿˜æ˜¯ä¼šå›æ¥æ”¹è¿™ä¸ªvalidatorã€‚è¿™æ ·å…¶å®æ˜¯è¿åäº†OCPã€‚</p>
<p>æˆ‘å½“æ—¶å…¶å®æƒ³åˆ°äº†å°†æ‰€æœ‰çš„ä¸œè¥¿æ”¾è¿›å»ä¸€ä¸ªvalidatorçš„â€å¼Šç«¯â€œï¼šé›†ä¸­äº†ä¿®æ”¹ã€‚ä½†æ˜¯è€ƒè™‘åˆ°è¿™ä¸ªéœ€æ±‚ä»¥åå¯èƒ½å¯¹äºæˆ‘ä»¬ç°æœ‰çš„objectå·²ç»è¶³å¤Ÿï¼Œä»¥åå¢åŠ å…¶ä»–çš„objectï¼ˆæœªçŸ¥ï¼‰ã€‚</p>
<p>ç»è¿‡ä»–çš„ä»‹ç»ï¼Œå†åŠ ä¸Šåˆçœ‹äº†è¿™ä¸ªæ–‡ç« ï¼Œæ¯”è¾ƒæ¸…æ™°çš„æ„è¯†åˆ°é—®é¢˜æ‰€åœ¨ã€‚</p>
<p>å¦‚æœè¦å¯¹é‚£ä¸ªä»£ç é‡æ„ï¼Œä½¿å…¶æ›´åŠ å…·æœ‰å¯æ‰©å±•æ€§ï¼Œæˆ‘ä¹‹å‰åŒäº‹è¯´çš„æ˜¯ï¼šâ€splitting it into a base class along with a set of different subclassesâ€œã€‚æˆ‘ç†è§£æˆ–è€…è¯´ç°åœ¨å¯ä»¥æƒ³åˆ°çš„ï¼š</p>
<ol>
<li>åšä¸€ä¸ªæŠ½è±¡ç±»åŒ…å«é€šç”¨çš„éƒ¨åˆ†ï¼›</li>
<li>æ¯ä¸ªä¸åŒçš„objectå»ç»§æ‰¿è¿™ä¸ªç±»ï¼Œé’ˆå¯¹è‡ªå·±çš„é€»è¾‘å¢åŠ ç‰¹å®šæ–¹æ³•ï¼›</li>
<li>ç„¶åå†åœ¨ä½¿ç”¨çš„åœ°æ–¹è°ƒç”¨è¿™äº›æ–¹æ³•å³å¯ï¼›</li>
</ol>
<p>è¿™æ ·åœ¨å¢åŠ å…¶ä»–çš„objectéœ€è¦ä½¿ç”¨ç±»ä¼¼çš„åŒæ ·å¯ä»¥ç»§æ‰¿é€šç”¨çš„éƒ¨åˆ†ï¼Œç„¶åä¾é å¤šæ€åœ¨è‡ªå·±çš„xxxObjectValidatorç±»ä¸­å»å®ç°è‡ªå·±çš„é€»è¾‘ã€‚</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E7%90%86%E8%AE%BA%E4%BA%8C%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E5%AF%B9%E6%89%A9%E5%B1%95%E5%BC%80%E6%94%BE-%E4%BF%AE%E6%94%B9%E5%85%B3%E9%97%AD%E6%89%A9%E5%B1%95%E5%92%8C%E4%BF%AE%E6%94%B9%E5%90%84%E6%8C%87%E4%BB%80%E4%B9%88">ç†è®ºäºŒï¼šå¦‚ä½•åšåˆ°â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿæ‰©å±•å’Œä¿®æ”¹å„æŒ‡ä»€ä¹ˆï¼Ÿ</a>
<ul>
<li><a href="#%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%AF%B9%E6%89%A9%E5%B1%95%E5%BC%80%E6%94%BE-%E4%BF%AE%E6%94%B9%E5%85%B3%E9%97%AD">å¦‚ä½•ç†è§£â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿ</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E6%84%8F%E5%91%B3%E7%9D%80%E8%BF%9D%E5%8F%8D%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99%E5%90%97">ä¿®æ”¹ä»£ç æ„å‘³ç€è¿åå¼€é—­åŸåˆ™å—</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E5%AF%B9%E6%89%A9%E5%B1%95%E5%BC%80%E6%94%BE-%E4%BF%AE%E6%94%B9%E5%85%B3%E9%97%AD">å¦‚ä½•åšåˆ°â€å¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€œ</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%81%B5%E6%B4%BB%E5%BA%94%E7%94%A8%E8%BF%99%E4%B8%AA%E5%8E%9F%E5%88%99">å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨è¿™ä¸ªåŸåˆ™ï¼Ÿ</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://10kshuaizhang.github.io/post/she-ji-mo-shi-zhi-mei-ke-cheng-bi-ji-7-she-ji-yuan-ze-1-solid/">
              <h3 class="post-title">
                è®¾è®¡æ¨¡å¼ä¹‹ç¾-è¯¾ç¨‹ç¬”è®°7-è®¾è®¡åŸåˆ™1-å•ä¸€èŒè´£(SRP)
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '3f6a89270d2a0e51772d',
    clientSecret: '58f2d7ec868483233a31553fa6235f2efd1df763',
    repo: '10kshuaizhang.github.io',
    owner: '10kshuaizhang',
    admin: ['10kshuaizhang'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  
  <a class="rss" href="https://10kshuaizhang.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
